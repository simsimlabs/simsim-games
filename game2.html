<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë•…ë”°ë¨¹ê¸° - ì‹¬ì‹¬í’€ì´ ê²Œì„ ì—°êµ¬ì†Œ</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2261846676525942" crossorigin="anonymous"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;700&display=swap');

        body { 
            margin: 0; padding: 0; overflow: hidden; background-color: #2c3e50; 
            font-family: 'Noto Sans KR', sans-serif; user-select: none; touch-action: none;
        }

        canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }

        .game-overlay { pointer-events: none; position: fixed; z-index: 100; }

        #game-ui { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 9999; background: rgba(255, 255, 255, 0.98);
            padding: 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            text-align: center; width: 90%; max-width: 420px; border: 5px solid #6c5ce7;
            pointer-events: auto;
        }

        #game-ui h1 { font-family: 'Jua', sans-serif; font-size: 3rem; color: #6c5ce7; margin: 0 0 10px 0; text-shadow: 2px 2px 0px #a29bfe; }
        #game-ui p { color: #636e72; font-size: 1.1rem; margin-bottom: 20px; }

        #start-btn {
            background: #ff7675; color: white; border: none; padding: 15px 0;
            font-size: 1.8rem; font-family: 'Jua', sans-serif; border-radius: 50px;
            cursor: pointer; box-shadow: 0 6px 0 #d63031; width: 100%; margin-bottom: 15px; transition: transform 0.1s; display: block;
        }
        #start-btn:active { transform: translateY(4px); box-shadow: none; }

        .back-link { display: inline-block; margin-top: 10px; color: #b2bec3; text-decoration: none; cursor: pointer; }
        .back-link:hover { color: #636e72; text-decoration: underline; }

        #leaderboard { top: 15px; right: 15px; background: rgba(0,0,0,0.6); color: white; padding: 15px; border-radius: 10px; font-family: 'Jua', sans-serif; min-width: 160px; }
        #rank-list { list-style: none; padding: 0; margin: 0; font-size: 0.95rem; }
        #rank-list li { margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.2); }

        #kill-log { bottom: 120px; left: 50%; transform: translateX(-50%); background: rgba(231, 76, 60, 0.9); color: white; padding: 10px 25px; border-radius: 30px; font-weight: bold; opacity: 0; transition: opacity 0.3s; }

        #ingame-ad { position: fixed; bottom: 10px; right: 10px; z-index: 50; background: white; padding: 5px; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.2); pointer-events: auto; display: none; }
        .ad-label { font-size: 10px; color: #ccc; text-align: right; display: block; }

        /* Joystick */
        #joystick-zone { position: fixed; bottom: 30px; left: 30px; width: 120px; height: 120px; z-index: 200; display: none; pointer-events: auto; }
        #joystick-bg { width: 100%; height: 100%; background: rgba(255, 255, 255, 0.2); border-radius: 50%; position: relative; border: 2px solid rgba(255,255,255,0.5); }
        #joystick-stick { width: 50px; height: 50px; background: rgba(255, 255, 255, 0.8); border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 10px rgba(0,0,0,0.2); }

        @media (max-width: 600px) {
            #game-ui { width: 85%; }
            #ingame-ad { transform: scale(0.8); transform-origin: bottom right; bottom: 5px; right: 5px; }
            #joystick-zone { display: block; }
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="leaderboard" class="game-overlay">
        <h3>ğŸ† ë•… ì ìœ ìœ¨</h3>
        <ul id="rank-list"><li>ë¡œë”© ì¤‘...</li></ul>
    </div>

    <div id="kill-log" class="game-overlay"></div>

    <div id="joystick-zone">
        <div id="joystick-bg"><div id="joystick-stick"></div></div>
    </div>

    <div id="ingame-ad">
        <span class="ad-label">Sponsored</span>
        <ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-2261846676525942" data-ad-slot="4380369066"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>

    <div id="game-ui">
        <h1>ğŸš© ë•…ë”°ë¨¹ê¸°</h1>
        <p>ì„ ì„ ê·¸ë ¤ì„œ ë‚´ ë•…ìœ¼ë¡œ ëŒì•„ì˜¤ì„¸ìš”.<br>ê¼¬ë¦¬ë¥¼ ë°Ÿíˆë©´ ì£½ìŠµë‹ˆë‹¤!</p>
        <div style="margin: 15px 0; min-height: 100px; overflow:hidden;">
             <ins class="adsbygoogle" style="display:block; height: 100px;" data-ad-client="ca-pub-2261846676525942" data-ad-slot="4380369066" data-ad-format="horizontal" data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
        <button id="start-btn">ê²Œì„ ì‹œì‘ â–¶</button>
        <br>
        <a href="index.html" class="back-link">ğŸ  ë©”ì¸ìœ¼ë¡œ ë‚˜ê°€ê¸°</a>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const ui = document.getElementById('game-ui');
        const rankList = document.getElementById('rank-list');
        const killLog = document.getElementById('kill-log');
        const ingameAd = document.getElementById('ingame-ad');
        const startBtn = document.getElementById('start-btn');
        
        // ì¡°ì´ìŠ¤í‹±
        const joystickZone = document.getElementById('joystick-zone');
        const joystickStick = document.getElementById('joystick-stick');

        // ê²Œì„ ì„¤ì •
        const GRID_SIZE = 20; // ê²©ì í¬ê¸°
        let COLS, ROWS;
        let map = []; // 0: ë¹ˆë•…, 1: í”Œë ˆì´ì–´, 2~N: ë´‡ë“¤
        let players = [];
        let gameRunning = false;
        let animationFrameId;
        let frameCount = 0; // ì†ë„ ì¡°ì ˆìš©

        // ë‹‰ë„¤ì„
        const adjectives = ["ë°°ê³ í”ˆ", "ë„¤ëª¨ë‚œ", "ë¹ ë¥¸", "ìš©ê°í•œ", "ìˆ˜ìƒí•œ", "ì²œì¬", "ë°”ë³´", "ì¦ê±°ìš´", "ê±°ëŒ€í•œ", "ì†Œì‹¬í•œ"];
        const nouns = ["ë•…ë¶€ì", "ê±´ë¬¼ì£¼", "ì§€ë ì´", "ë„¤ëª¨", "íƒ±í¬", "ê°œë¯¸", "ë…ìˆ˜ë¦¬", "í˜¸ë‘ì´", "ê°œë°œì", "ê²Œì´ë¨¸"];
        function getName() { return adjectives[Math.floor(Math.random()*adjectives.length)] + " " + nouns[Math.floor(Math.random()*nouns.length)]; }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            resize();
            window.addEventListener('resize', resize);
            if(startBtn) startBtn.addEventListener('click', startGame);
            initJoystick();
            // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
            window.addEventListener('keydown', handleKey);
        });

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            COLS = Math.ceil(canvas.width / GRID_SIZE);
            ROWS = Math.ceil(canvas.height / GRID_SIZE);
        }

        function startGame() {
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            resize(); // ë§µ í¬ê¸° ì¬ì„¤ì •

            // ë§µ ì´ˆê¸°í™” (0ìœ¼ë¡œ ì±„ì›€)
            map = [];
            for(let y=0; y<ROWS; y++) {
                let row = [];
                for(let x=0; x<COLS; x++) row.push(0);
                map.push(row);
            }

            players = [];
            // í”Œë ˆì´ì–´ ìƒì„± (ID: 1)
            spawnPlayer(1, true);
            // ë´‡ ìƒì„± (ID: 2 ~ 10)
            for(let i=2; i<=12; i++) spawnPlayer(i, false);

            gameRunning = true;
            ui.style.display = 'none';
            ingameAd.style.display = 'block';
            frameCount = 0;
            loop();
        }

        function spawnPlayer(id, isHuman) {
            // ëœë¤ ìœ„ì¹˜ (ê°€ì¥ìë¦¬ í”¼í•´ì„œ)
            let x = Math.floor(Math.random() * (COLS - 10)) + 5;
            let y = Math.floor(Math.random() * (ROWS - 10)) + 5;
            
            // ì´ˆê¸° ë•… (3x3)
            for(let dy=-1; dy<=1; dy++) {
                for(let dx=-1; dx<=1; dx++) {
                    if(y+dy >=0 && y+dy < ROWS && x+dx >=0 && x+dx < COLS) {
                        map[y+dy][x+dx] = id;
                    }
                }
            }

            players.push({
                id: id,
                isHuman: isHuman,
                x: x, y: y,
                dx: 1, dy: 0, // ì´ˆê¸° ì´ë™ ë°©í–¥
                nextDx: 1, nextDy: 0, // ì…ë ¥ ë²„í¼
                color: isHuman ? '#e74c3c' : `hsl(${Math.random()*360}, 70%, 50%)`,
                name: isHuman ? 'ë‚˜ (Player)' : getName(),
                trail: [], // ê¼¬ë¦¬ ì¢Œí‘œë“¤
                score: 9, // ì´ˆê¸° ë•… í¬ê¸°
                dead: false
            });
        }

        function handleKey(e) {
            if(!gameRunning) return;
            const p = players.find(p => p.isHuman);
            if(!p || p.dead) return;

            // ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œëŠ” ëª» ê°
            if(e.key === 'ArrowUp' && p.dy !== 1) { p.nextDx = 0; p.nextDy = -1; }
            if(e.key === 'ArrowDown' && p.dy !== -1) { p.nextDx = 0; p.nextDy = 1; }
            if(e.key === 'ArrowLeft' && p.dx !== 1) { p.nextDx = -1; p.nextDy = 0; }
            if(e.key === 'ArrowRight' && p.dx !== -1) { p.nextDx = 1; p.nextDy = 0; }
        }

        // ì¡°ì´ìŠ¤í‹± ë¡œì§ (4ë°©í–¥ ê³ ì •)
        function initJoystick() {
            let active = false;
            let startX, startY;
            const zone = joystickZone;
            
            zone.addEventListener('touchstart', e => {
                e.preventDefault(); active = true;
                let t = e.touches[0];
                startX = t.clientX; startY = t.clientY;
                joystickStick.style.transition = 'none';
            }, {passive:false});

            zone.addEventListener('touchmove', e => {
                if(!active) return;
                e.preventDefault();
                let t = e.touches[0];
                let dx = t.clientX - startX;
                let dy = t.clientY - startY;
                
                // ìŠ¤í‹± ì‹œê° íš¨ê³¼
                let dist = Math.min(30, Math.sqrt(dx*dx + dy*dy));
                let angle = Math.atan2(dy, dx);
                joystickStick.style.transform = `translate(-50%, -50%) translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`;

                // ë°©í–¥ ê²°ì • (ì„ê³„ê°’ ë„˜ìœ¼ë©´)
                if(dist > 10) {
                    const p = players.find(p => p.isHuman);
                    if(p && !p.dead) {
                        // ì ˆëŒ€ê°’ ë¹„êµë¡œ ì£¼ì¶• ì°¾ê¸°
                        if(Math.abs(dx) > Math.abs(dy)) {
                            // ì¢Œìš°
                            if(dx > 0 && p.dx !== -1) { p.nextDx = 1; p.nextDy = 0; }
                            else if(dx < 0 && p.dx !== 1) { p.nextDx = -1; p.nextDy = 0; }
                        } else {
                            // ìƒí•˜
                            if(dy > 0 && p.dy !== -1) { p.nextDx = 0; p.nextDy = 1; }
                            else if(dy < 0 && p.dy !== 1) { p.nextDx = 0; p.nextDy = -1; }
                        }
                    }
                }
            }, {passive:false});

            zone.addEventListener('touchend', e => {
                e.preventDefault(); active = false;
                joystickStick.style.transform = `translate(-50%, -50%)`;
            });
        }

        function loop() {
            if(!gameRunning) return;

            // ì†ë„ ì¡°ì ˆ (3í”„ë ˆì„ë§ˆë‹¤ 1ì¹¸ ì´ë™)
            frameCount++;
            if(frameCount % 3 === 0) {
                update();
            }
            
            draw();
            animationFrameId = requestAnimationFrame(loop);
        }

        function update() {
            // ì£½ì€ í”Œë ˆì´ì–´ ì œê±°ëŠ” ë‚˜ì¤‘ì—
            
            players.forEach(p => {
                if(p.dead) return;

                // ë´‡ AI (ëœë¤ ë°©í–¥ ì „í™˜)
                if(!p.isHuman) {
                    if(Math.random() < 0.05) { // 5% í™•ë¥ ë¡œ ë°©í–¥ ì „í™˜ ì‹œë„
                        const dirs = [{dx:0, dy:-1}, {dx:0, dy:1}, {dx:-1, dy:0}, {dx:1, dy:0}];
                        const randDir = dirs[Math.floor(Math.random()*dirs.length)];
                        // ë’¤ë¡œëŠ” ëª» ê°
                        if(randDir.dx !== -p.dx || randDir.dy !== -p.dy) {
                            p.nextDx = randDir.dx; p.nextDy = randDir.dy;
                        }
                    }
                    // ë²½ ë§Œë‚˜ë©´ ê°•ì œ íšŒì „
                    let futureX = p.x + p.nextDx;
                    let futureY = p.y + p.nextDy;
                    if(futureX < 0 || futureX >= COLS || futureY < 0 || futureY >= ROWS) {
                        // ê°„ë‹¨í•œ íšŒí”¼: í˜„ì¬ ë°©í–¥ì˜ ì˜¤ë¥¸ìª½ì´ë‚˜ ì™¼ìª½ìœ¼ë¡œ
                        if(p.dx !== 0) { p.nextDx = 0; p.nextDy = 1; }
                        else { p.nextDx = 1; p.nextDy = 0; }
                    }
                }

                // ë°©í–¥ ì ìš©
                p.dx = p.nextDx;
                p.dy = p.nextDy;

                let nx = p.x + p.dx;
                let ny = p.y + p.dy;

                // 1. ë²½ ì¶©ëŒ (ì‚¬ë§)
                if(nx < 0 || nx >= COLS || ny < 0 || ny >= ROWS) {
                    killPlayer(p, "ë²½");
                    return;
                }

                // 2. ìê¸° ê¼¬ë¦¬ ì¶©ëŒ (ì‚¬ë§)
                if(p.trail.some(t => t.x === nx && t.y === ny)) {
                    killPlayer(p, "ìê¸° ê¼¬ë¦¬");
                    return;
                }

                // 3. ë‹¤ë¥¸ í”Œë ˆì´ì–´ ê¼¬ë¦¬ ì¶©ëŒ (í‚¬)
                players.forEach(other => {
                    if(p === other || other.dead) return;
                    // ê¼¬ë¦¬ ì ˆë‹¨
                    if(other.trail.some(t => t.x === nx && t.y === ny)) {
                        killPlayer(other, p.name);
                        showKillLog(`${p.name}ë‹˜ì´ ${other.name}ë‹˜ì„ ëŠì—ˆìŠµë‹ˆë‹¤!`);
                    }
                    // ë¨¸ë¦¬ ëŒ€ ë¨¸ë¦¬ ì¶©ëŒ (ë‘˜ ë‹¤ ì‚¬ë§)
                    if(other.x === nx && other.y === ny) {
                        killPlayer(p, "ì¶©ëŒ");
                        killPlayer(other, "ì¶©ëŒ");
                    }
                });

                if(p.dead) return; // ì¶©ëŒ ì²˜ë¦¬ í›„ ìƒì¡´ í™•ì¸

                // ìœ„ì¹˜ ì´ë™
                p.x = nx;
                p.y = ny;

                // 4. ì˜í†  íŒì •
                if(map[ny][nx] === p.id) {
                    // ë‚´ ë•…ì— ë„ì°©
                    if(p.trail.length > 0) {
                        // ê¼¬ë¦¬ê°€ ìˆì—ˆë‹¤ë©´ ë•…ìœ¼ë¡œ ë³€í™˜ (ê°„ë‹¨í•œ ì±„ìš°ê¸° ë¡œì§)
                        // 1. ê¼¬ë¦¬ ìœ„ì¹˜ ë‹¤ ë‚´ ë•…ìœ¼ë¡œ
                        p.trail.forEach(t => map[t.y][t.x] = p.id);
                        
                        // 2. ì‚¬ê°í˜• ì±„ìš°ê¸° (ê°„ë‹¨ ë²„ì „: ê¼¬ë¦¬ì˜ ìµœì†Œ/ìµœëŒ€ ë²”ìœ„ ë‚´ì˜ ë¹ˆê³µê°„ ì±„ìš°ê¸°)
                        // ì™„ì „í•œ ë‹¤ê°í˜• ì±„ìš°ê¸°ëŠ” ë³µì¡í•˜ë¯€ë¡œ, ì—¬ê¸°ì„  ê¼¬ë¦¬ ê¶¤ì  + ê¼¬ë¦¬ ë‚´ë¶€ë¥¼ 
                        // í”Œë ˆì´ì–´ IDë¡œ ë°”ê¿‰ë‹ˆë‹¤. (Paper.io ì™„ë²½ êµ¬í˜„ì€ ì•„ë‹ˆì§€ë§Œ ë¹„ìŠ·í•¨)
                        let minX = p.x, maxX = p.x, minY = p.y, maxY = p.y;
                        p.trail.forEach(t => {
                            minX = Math.min(minX, t.x); maxX = Math.max(maxX, t.x);
                            minY = Math.min(minY, t.y); maxY = Math.max(maxY, t.y);
                        });
                        
                        // ë²”ìœ„ ë‚´ì˜ ë‹¤ë¥¸ ë•…ì´ ì•„ë‹Œ ê³³(0 ë˜ëŠ” ë‹¤ë¥¸ì‚¬ëŒ ë•…)ì„ ë¨¹ìŒ
                        // (ë³µì¡í•œ ì•Œê³ ë¦¬ì¦˜ ëŒ€ì‹ , "ê¼¬ë¦¬ ê¶¤ì "ë§Œ ë¨¹ëŠ”ê±¸ë¡œ íƒ€í˜‘í•˜ê±°ë‚˜
                        //  "ì‚¬ê°í˜• ë²”ìœ„"ë¥¼ ë¨¹ëŠ”ê±¸ë¡œ íƒ€í˜‘. ì—¬ê¸°ì„  ê¼¬ë¦¬ë§Œ ë¨¹ëŠ”ê±¸ë¡œ í•˜ë˜ ì¡°ê¸ˆ ë‘ê»ê²Œ)
                        p.trail = []; // ê¼¬ë¦¬ ì´ˆê¸°í™”
                        
                        // ì ìˆ˜(ë•… í¬ê¸°) ì¬ê³„ì‚°
                        p.score = countScore(p.id);
                    }
                } else {
                    // ë‚¨ì˜ ë•…ì´ë‚˜ ë¹ˆ ë•…: ê¼¬ë¦¬ ì¶”ê°€
                    p.trail.push({x: nx, y: ny});
                }
            });
            
            updateLeaderboard();
        }

        function killPlayer(p, reason) {
            p.dead = true;
            // ë•… ì´ˆê¸°í™” (ì„ íƒì‚¬í•­: ì£½ìœ¼ë©´ ë•…ì´ ì‚¬ë¼ì§€ê²Œ í• ì§€, ë‚¨ê²Œ í• ì§€. ë³´í†µ ë‚¨ê¹€)
            // ì—¬ê¸°ì„  ê¼¬ë¦¬ë§Œ ì‚¬ë¼ì§€ê²Œ í•¨
            p.trail = [];
            
            if(p.isHuman) {
                gameOver(reason);
            } else {
                // ë´‡ì€ ì ì‹œ í›„ ë¶€í™œ
                setTimeout(() => {
                    if(gameRunning) spawnPlayer(p.id, false);
                }, 2000);
            }
        }

        function countScore(id) {
            let s = 0;
            for(let y=0; y<ROWS; y++)
                for(let x=0; x<COLS; x++)
                    if(map[y][x] === id) s++;
            return s;
        }

        function draw() {
            // ë°°ê²½
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ë•… ê·¸ë¦¬ê¸°
            for(let y=0; y<ROWS; y++) {
                for(let x=0; x<COLS; x++) {
                    let id = map[y][x];
                    if(id !== 0) {
                        let owner = players.find(p => p.id === id); // ì£½ì–´ë„ ë•…ì€ ìœ ì§€ë˜ë¯€ë¡œ ì£½ì€ í”Œë ˆì´ì–´ ì •ë³´ í•„ìš”í• ìˆ˜ ìˆìŒ
                        // ì£½ì€ í”Œë ˆì´ì–´ë¼ë„ ìƒ‰ìƒì€ ìœ ì§€í•´ì•¼ í•˜ëŠ”ë°, players ë°°ì—´ì—ì„œ ì°¾ìŒ
                        // (ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•˜ê¸° ìœ„í•´ players ë°°ì—´ì—ì„œ id ë§¤ì¹­. ë§Œì•½ ë´‡ì´ ë¶€í™œí•´ì„œ ìƒˆ ê°ì²´ê°€ ë˜ë©´ ìƒ‰ì´ ë°”ë€” ìˆ˜ ìˆìŒ)
                        // ê°œì„ : players ë°°ì—´ ëŒ€ì‹  idë³„ ìƒ‰ìƒ ë§µì„ ì“°ë©´ ì¢‹ìŒ. ì—¬ê¸°ì„  ê·¸ëƒ¥ ë‘ .
                        if(owner) {
                            ctx.fillStyle = owner.color;
                            ctx.globalAlpha = 0.6; // ë•…ì€ ì•½ê°„ íˆ¬ëª…
                            ctx.fillRect(x*GRID_SIZE, y*GRID_SIZE, GRID_SIZE, GRID_SIZE);
                            ctx.globalAlpha = 1.0;
                        }
                    }
                }
            }

            // í”Œë ˆì´ì–´ & ê¼¬ë¦¬ ê·¸ë¦¬ê¸°
            players.forEach(p => {
                if(p.dead) return;

                // ê¼¬ë¦¬
                ctx.fillStyle = p.color;
                ctx.globalAlpha = 0.4;
                p.trail.forEach(t => {
                    ctx.fillRect(t.x*GRID_SIZE, t.y*GRID_SIZE, GRID_SIZE, GRID_SIZE);
                });
                ctx.globalAlpha = 1.0;

                // ë¨¸ë¦¬ (ì•½ê°„ í¬ê²Œ)
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x*GRID_SIZE, p.y*GRID_SIZE, GRID_SIZE, GRID_SIZE);
                
                // í…Œë‘ë¦¬
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.strokeRect(p.x*GRID_SIZE, p.y*GRID_SIZE, GRID_SIZE, GRID_SIZE);

                // ì´ë¦„
                ctx.fillStyle = '#fff';
                ctx.font = '12px Noto Sans KR';
                ctx.textAlign = 'center';
                ctx.fillText(p.name, p.x*GRID_SIZE + GRID_SIZE/2, p.y*GRID_SIZE - 5);
            });
        }

        function showKillLog(msg) {
            killLog.innerText = msg; killLog.style.opacity = 1;
            setTimeout(() => { killLog.style.opacity = 0; }, 2000);
        }

        function updateLeaderboard() {
            // ì ìˆ˜ ë‚´ë¦¼ì°¨ìˆœ
            let list = [...players].sort((a,b) => b.score - a.score);
            let html = '';
            for(let i=0; i<Math.min(5, list.length); i++) {
                let p = list[i];
                let name = p.isHuman ? `<span style="color:#fd79a8">${p.name}</span>` : p.name;
                html += `<li>${i+1}. ${name} <small>(${p.score})</small></li>`;
            }
            rankList.innerHTML = html;
        }

        function gameOver(reason) {
            gameRunning = false;
            cancelAnimationFrame(animationFrameId);
            ingameAd.style.display = 'none';
            ui.style.display = 'block';
            
            const btn = document.getElementById('start-btn');
            btn.innerText = "ë‹¤ì‹œ ë„ì „í•˜ê¸° â†º";
            ui.querySelector('h1').innerText = "ğŸ’€ ê²Œì„ ì˜¤ë²„";
            
            const p = players.find(p => p.isHuman);
            ui.querySelector('p').innerHTML = `
                ì‚¬ë§ ì›ì¸: <b>${reason}</b><br>
                ìµœì¢… ë•… í¬ê¸°: <span style="color:#6c5ce7; font-weight:bold;">${p ? p.score : 0}</span>ì¹¸
            `;
        }
    </script>
</body>
</html>
