<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ê³¼ì¼ í•©ì¹˜ê¸° - ì‹¬ì‹¬í’€ì´ ê²Œì„ ì—°êµ¬ì†Œ</title>
    <meta property="og:type" content="website">
<meta property="og:title" content="ğŸ‰ ê³¼ì¼ í•©ì¹˜ê¸° - ì‹¬ì‹¬í’€ì´ ê²Œì„ ì—°êµ¬ì†Œ">
<meta property="og:description" content="ì²´ë¦¬ë¶€í„° ìˆ˜ë°•ê¹Œì§€! ë˜‘ê°™ì€ ê³¼ì¼ì„ í•©ì³ ë” í° ê³¼ì¼ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”. ì¤‘ë…ì„± 1ìœ„ í¼ì¦ ê²Œì„.">
<meta property="og:image" content="https://simsimlabs.github.io/simsim-games/thumbnail.png">
<meta property="og:url" content="https://simsimlabs.github.io/simsim-games/game6.html">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2261846676525942" crossorigin="anonymous"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;700&display=swap');

        body { 
            margin: 0; padding: 0; overflow: hidden; background-color: #ffeaa7; 
            font-family: 'Noto Sans KR', sans-serif; touch-action: none; user-select: none;
        }

        canvas { display: block; margin: 0 auto; background-color: #fff8e1; border-left: 2px solid #fdcb6e; border-right: 2px solid #fdcb6e; box-shadow: 0 0 20px rgba(0,0,0,0.1); }

        #game-ui { 
            position: fixed; top: 20px; left: 20px; pointer-events: none;
            font-family: 'Jua', sans-serif; color: #2d3436;
        }
        #score-box { font-size: 2rem; text-shadow: 2px 2px 0px white; }
        
        #game-over {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95); padding: 40px; border-radius: 20px;
            text-align: center; border: 5px solid #fdcb6e; box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none; pointer-events: auto;
        }
        #game-over h1 { margin: 0 0 10px 0; font-family: 'Jua', sans-serif; font-size: 3rem; color: #e17055; }
        #restart-btn {
            background: #00b894; color: white; border: none; padding: 15px 30px;
            font-size: 1.5rem; font-family: 'Jua', sans-serif; border-radius: 50px;
            cursor: pointer; margin-top: 15px; box-shadow: 0 5px 0 #008f6d;
        }
        #restart-btn:active { transform: translateY(4px); box-shadow: none; }
        
        .back-link { 
            position: fixed; top: 20px; right: 20px; text-decoration: none; 
            background: rgba(255,255,255,0.8); padding: 10px 15px; border-radius: 20px;
            font-weight: bold; color: #636e72; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            pointer-events: auto;
        }

        #ingame-ad { position: fixed; bottom: 0; left: 0; width: 100%; text-align: center; pointer-events: none; }
        .adsbygoogle { display: inline-block; pointer-events: auto; }
    </style>
</head>
<body>

    <div id="game-ui">
        <div id="score-box">ì ìˆ˜: 0</div>
        <div style="font-size: 1rem; color: #636e72;">ë‹¤ìŒ ê³¼ì¼: <span id="next-fruit" style="font-size: 1.5rem;">ğŸ’</span></div>
    </div>

    <a href="index.html" class="back-link">ğŸ  ë‚˜ê°€ê¸°</a>

    <div id="game-over">
        <h1>ğŸ˜² ë„˜ì³¤ì–´ìš”!</h1>
        <p>ìµœì¢… ì ìˆ˜: <span id="final-score" style="color:#e17055; font-weight:bold;">0</span></p>
        <button id="restart-btn">ë‹¤ì‹œ ë„ì „ â–¶</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="ingame-ad">
        <ins class="adsbygoogle"
             style="display:inline-block;width:320px;height:50px"
             data-ad-client="ca-pub-2261846676525942"
             data-ad-slot="4380369066"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score-box');
        const nextFruitEl = document.getElementById('next-fruit');
        const gameOverEl = document.getElementById('game-over');
        const finalScoreEl = document.getElementById('final-score');
        const restartBtn = document.getElementById('restart-btn');

        // ê³¼ì¼ ë‹¨ê³„ (ë°˜ì§€ë¦„ ì¡°ì •)
        const FRUITS = [
            { r: 16, color: '#ff7675', name: 'ğŸ’' }, 
            { r: 26, color: '#fd79a8', name: 'ğŸ“' }, 
            { r: 36, color: '#6c5ce7', name: 'ğŸ‡' }, 
            { r: 46, color: '#fab1a0', name: 'ğŸŠ' }, 
            { r: 60, color: '#e17055', name: 'ğŸ' }, 
            { r: 74, color: '#ffeaa7', name: 'ğŸ' }, 
            { r: 90, color: '#fdcb6e', name: 'ğŸ‘' }, 
            { r: 108, color: '#00b894', name: 'ğŸ' }, 
            { r: 128, color: '#81ecec', name: 'ğŸˆ' }, 
            { r: 154, color: '#2d3436', name: 'ğŸ‰' }  
        ];

        let balls = [];
        let particles = [];
        let score = 0;
        let gameOver = false;
        let nextFruitIdx = 0;
        let dropping = false;
        let mouseX = 0;

        let GAME_WIDTH = 450; 
        let GAME_HEIGHT = 800;

        function resize() {
            if(window.innerWidth < 500) {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            } else {
                canvas.width = 450;
                canvas.height = 800;
            }
            GAME_WIDTH = canvas.width;
            GAME_HEIGHT = canvas.height;
        }
        window.addEventListener('resize', resize);
        resize();

        function init() {
            balls = [];
            particles = [];
            score = 0;
            gameOver = false;
            gameOverEl.style.display = 'none';
            scoreEl.innerText = "ì ìˆ˜: 0";
            nextFruitIdx = 0;
            updateNextFruit();
            requestAnimationFrame(loop);
        }

        canvas.addEventListener('mousemove', e => {
            const rect = canvas.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
        });
        canvas.addEventListener('touchmove', e => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            mouseX = e.touches[0].clientX - rect.left;
        }, {passive: false});

        function handleInput() {
            if(gameOver || dropping) return;
            dropping = true;
            
            let x = Math.max(FRUITS[nextFruitIdx].r, Math.min(GAME_WIDTH - FRUITS[nextFruitIdx].r, mouseX));
            addBall(x, 50, nextFruitIdx);

            nextFruitIdx = Math.floor(Math.random() * 4);
            updateNextFruit();

            setTimeout(() => { dropping = false; }, 600);
        }

        canvas.addEventListener('mousedown', handleInput);
        canvas.addEventListener('touchstart', handleInput);
        restartBtn.addEventListener('click', init);

        function updateNextFruit() {
            nextFruitEl.innerText = FRUITS[nextFruitIdx].name;
        }

        function addBall(x, y, level) {
            balls.push({
                x: x, y: y,
                vx: 0, vy: 0,
                level: level,
                r: FRUITS[level].r,
                mass: FRUITS[level].r,
                angle: 0,
                merged: false
            });
        }

        function createParticles(x, y, color) {
            for(let i=0; i<8; i++) {
                particles.push({
                    x: x, y: y,
                    vx: (Math.random()-0.5)*4, vy: (Math.random()-0.5)*4,
                    life: 20 + Math.random()*10, color: color, r: Math.random()*3 + 2
                });
            }
        }

        function loop() {
            if(gameOver) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ê°€ì´ë“œë¼ì¸ ë° ë¯¸ë¦¬ë³´ê¸°
            if(!dropping) {
                ctx.beginPath();
                ctx.moveTo(mouseX, 20); ctx.lineTo(mouseX, GAME_HEIGHT);
                ctx.strokeStyle = 'rgba(0,0,0,0.1)'; ctx.lineWidth = 2; ctx.stroke();
                
                ctx.globalAlpha = 0.5;
                let previewX = Math.max(FRUITS[nextFruitIdx].r, Math.min(GAME_WIDTH - FRUITS[nextFruitIdx].r, mouseX));
                
                // ë¯¸ë¦¬ë³´ê¸° í¬ê¸°ë„ ê½‰ ì°¨ê²Œ
                ctx.font = `${FRUITS[nextFruitIdx].r * 2.3}px sans-serif`;
                ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                ctx.fillText(FRUITS[nextFruitIdx].name, previewX, 50);
                ctx.globalAlpha = 1.0;
            }

            ctx.beginPath();
            ctx.moveTo(0, 100); ctx.lineTo(GAME_WIDTH, 100);
            ctx.strokeStyle = '#fab1a0'; ctx.setLineDash([5, 5]); ctx.stroke(); ctx.setLineDash([]);

            // --- ë¬¼ë¦¬ ì—”ì§„ ì†ë„ ê°ì†Œ ---
            // Stepì„ 3íšŒë¡œ ì¤„ì´ê³ , ì¤‘ë ¥ì„ 0.04ë¡œ ëŒ€í­ ë‚®ì¶¤
            for(let step=0; step<3; step++) {
                balls.forEach(b => {
                    b.vy += 0.04; // ì¤‘ë ¥ ê°ì†Œ (0.08 -> 0.04)
                    b.x += b.vx; b.y += b.vy;
                    b.vx *= 0.99; b.vy *= 0.99;
                    b.angle += b.vx * 0.02;

                    if(b.x < b.r) { b.x = b.r; b.vx *= -0.4; } // íƒ„ì„± ê°ì†Œ
                    if(b.x > GAME_WIDTH - b.r) { b.x = GAME_WIDTH - b.r; b.vx *= -0.4; }
                    if(b.y > GAME_HEIGHT - b.r) { b.y = GAME_HEIGHT - b.r; b.vy *= -0.4; }
                });

                for(let i=0; i<balls.length; i++) {
                    for(let j=i+1; j<balls.length; j++) {
                        let b1 = balls[i], b2 = balls[j];
                        if(b1.merged || b2.merged) continue;
                        let dx = b2.x - b1.x, dy = b2.y - b1.y;
                        let distSq = dx*dx + dy*dy, radSum = b1.r + b2.r;

                        if(distSq < radSum * radSum) {
                            let dist = Math.sqrt(distSq);
                            
                            if(b1.level === b2.level && b1.level < FRUITS.length-1) {
                                b1.merged = true; b2.merged = true;
                                let newX = (b1.x + b2.x) / 2, newY = (b1.y + b2.y) / 2;
                                addBall(newX, newY, b1.level + 1);
                                createParticles(newX, newY, FRUITS[b1.level].color);
                                score += (b1.level + 1) * 10;
                                scoreEl.innerText = `ì ìˆ˜: ${score}`;
                                continue;
                            }

                            let overlap = radSum - dist, nx = dx / dist, ny = dy / dist;
                            b1.x -= nx * overlap * 0.5; b1.y -= ny * overlap * 0.5;
                            b2.x += nx * overlap * 0.5; b2.y += ny * overlap * 0.5;
                            
                            let dvx = b2.vx - b1.vx, dvy = b2.vy - b1.vy;
                            let velAlongNormal = dvx * nx + dvy * ny;
                            if(velAlongNormal > 0) continue;
                            
                            let impulse = -(1.2) * velAlongNormal / (1/b1.mass + 1/b2.mass);
                            b1.vx -= (1/b1.mass) * impulse * nx; b1.vy -= (1/b1.mass) * impulse * ny;
                            b2.vx += (1/b2.mass) * impulse * nx; b2.vy += (1/b2.mass) * impulse * ny;
                        }
                    }
                }
            }

            balls = balls.filter(b => !b.merged);

            // ê³¼ì¼ ê·¸ë¦¬ê¸°
            balls.forEach(b => {
                ctx.save();
                ctx.translate(b.x, b.y);
                ctx.rotate(b.angle);
                
                // ì´ëª¨ì§€ í¬ê¸° í‚¤ì›€ (2.3ë°°) -> íˆíŠ¸ë°•ìŠ¤ì— ê½‰ ì°¨ê²Œ
                ctx.font = `${b.r * 2}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                // ì´ëª¨ì§€ ìˆ˜ì§ ì¤‘ì‹¬ ë³´ì • (ì•½ê°„ ì˜¬ë ¤ì•¼ ì› ì¤‘ì‹¬ì— ë§ìŒ)
                ctx.fillText(FRUITS[b.level].name, 0, b.r * 0.1); 

                // ë””ë²„ê·¸: íˆíŠ¸ë°•ìŠ¤ í™•ì¸ìš© (í•„ìš”ì‹œ ì£¼ì„ í•´ì œ)
                // ctx.beginPath(); ctx.arc(0, 0, b.r, 0, Math.PI*2); ctx.strokeStyle='red'; ctx.stroke();

                ctx.restore();
            });

             // íŒŒí‹°í´
             for(let i=particles.length-1; i>=0; i--) {
                let p = particles[i];
                p.x += p.vx; p.y += p.vy; p.life--;
                if(p.life <= 0) { particles.splice(i,1); continue; }
                ctx.globalAlpha = p.life / 30;
                ctx.fillStyle = p.color;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
                ctx.globalAlpha = 1.0;
            }

            for(let b of balls) {
                if(b.y - b.r < 100 && Math.abs(b.vy) < 0.1 && Math.abs(b.vx) < 0.1 && !dropping) {
                    gameOver = true;
                    finalScoreEl.innerText = score;
                    gameOverEl.style.display = 'block';
                    break;
                }
            }

            requestAnimationFrame(loop);
        }

        init();
    </script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    /* ê³µìœ  ì»¨í…Œì´ë„ˆ: í™”ë©´ í•˜ë‹¨ ì¤‘ì•™ì— ê³ ì • */
    .game-share-wrapper {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(30, 30, 40, 0.85); /* ë°˜íˆ¬ëª… ê²€ì • ë°°ê²½ */
        padding: 12px 25px;
        border-radius: 50px;
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        gap: 15px;
        z-index: 9999;
        box-shadow: 0 5px 20px rgba(0,0,0,0.4);
    }

    .share-label {
        color: #fff;
        font-size: 0.9rem;
        font-weight: bold;
        margin-right: 5px;
        white-space: nowrap;
    }

    .share-btn-group {
        display: flex;
        gap: 10px;
    }

    .share-icon-btn {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        border: none;
        color: white;
        font-size: 1rem;
        cursor: pointer;
        transition: transform 0.2s, background-color 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .share-icon-btn:hover { transform: translateY(-3px); }
    
    /* ê° ë²„íŠ¼ ìƒ‰ìƒ */
    .bg-twitter { background-color: #1DA1F2; }
    .bg-facebook { background-color: #1877F2; }
    .bg-link { background-color: #6c5ce7; }

    /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ (ë³µì‚¬ ì•Œë¦¼) */
    #copy-toast {
        visibility: hidden;
        min-width: 250px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 4px;
        padding: 16px;
        position: fixed;
        z-index: 10000;
        left: 50%;
        bottom: 80px; /* ê³µìœ  ë²„íŠ¼ë³´ë‹¤ ìœ„ì— ëœ¸ */
        transform: translateX(-50%);
        font-size: 0.9rem;
        opacity: 0;
        transition: opacity 0.5s, bottom 0.5s;
    }

    #copy-toast.show {
        visibility: visible;
        opacity: 1;
        bottom: 90px;
    }
    
    /* ëª¨ë°”ì¼ ëŒ€ì‘ */
    @media (max-width: 500px) {
        .share-label { display: none; } /* í™”ë©´ ì¢ìœ¼ë©´ ê¸€ì ìˆ¨ê¹€ */
        .game-share-wrapper { padding: 10px; }
    }
</style>

<div class="game-share-wrapper">
    <span class="share-label">ğŸ“¢ ì¹œêµ¬ì™€ ê³µìœ í•˜ê¸°</span>
    <div class="share-btn-group">
        <button onclick="shareTo('twitter')" class="share-icon-btn bg-twitter" title="íŠ¸ìœ„í„°">
            <i class="fa-brands fa-twitter"></i>
        </button>
        <button onclick="shareTo('facebook')" class="share-icon-btn bg-facebook" title="í˜ì´ìŠ¤ë¶">
            <i class="fa-brands fa-facebook-f"></i>
        </button>
        <button onclick="copyLink()" class="share-icon-btn bg-link" title="ë§í¬ ë³µì‚¬">
            <i class="fa-solid fa-link"></i>
        </button>
    </div>
</div>

<div id="copy-toast">ğŸ“‹ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>

<script>
    function shareTo(sns) {
        const url = encodeURIComponent(window.location.href);
        const title = encodeURIComponent(document.title);
        let link = "";

        if (sns === 'twitter') {
            link = `https://twitter.com/intent/tweet?text=${title}&url=${url}`;
        } else if (sns === 'facebook') {
            link = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
        }
        
        if(link) window.open(link, '_blank', 'width=600,height=400');
    }

    function copyLink() {
        const url = window.location.href;
        navigator.clipboard.writeText(url).then(() => {
            const toast = document.getElementById("copy-toast");
            toast.className = "show";
            setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3000);
        }).catch(err => {
            alert("ë³µì‚¬ ì‹¤íŒ¨: " + err);
        });
    }
</script>

<div id="game-desc-box">
    <h3 class="desc-title">ğŸ’¡ How to Play <button class="close-desc-btn" onclick="hideGameDesc()">Ã—</button></h3>
    <p style="font-size: 0.9rem; margin-bottom: 15px;">Merge identical fruits into a Watermelon.</p>
    <ul class="desc-list">
        <li><strong>ì¡°ì‘:</strong> ì¡°ì¤€í•˜ê³ , ë–¨ì–´ëœ¨ë¦¬ì„¸ìš” </li>
        <li><strong>í•©ì¹˜ê¸°:</strong> ì²´ë¦¬ > ... > ìˆ˜ë°• </li>
        <li><strong>ì£¼ì˜:</strong> ë„˜ì¹˜ì§€ ì•Šê²Œ ì¡°ì‹¬í•˜ì„¸ìš”!</li>
    </ul>
    <div class="desc-tip">âœ¨ <strong>íŒ:</strong> í° ê³¼ì¼ì„ êµ¬ì„ì— ëª°ì•„ë³´ì„¸ìš” </div>
</div>
    
</body>
</html>
