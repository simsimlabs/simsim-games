<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë•…ë”°ë¨¹ê¸° - ì‹¬ì‹¬í’€ì´ ê²Œì„ ì—°êµ¬ì†Œ</title>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2261846676525942" crossorigin="anonymous"></script>
    
    <link rel="canonical" href="https://simsimlabs.com/simsim-games/game2.html">

    <meta name="description" content="ë•…ë”°ë¨¹ê¸°(Land Conquer) ë¬´ë£Œ ì›¹ê²Œì„. ì„ ì„ ê·¸ë ¤ ë‚´ ì˜í† ë¥¼ ë„“íˆê³  ì ì˜ ê¼¬ë¦¬ë¥¼ ë°Ÿì•„ ì œê±°í•˜ì„¸ìš”. ì„¤ì¹˜ ì—†ëŠ” ì „ëµ ì„œë°”ì´ë²Œ ê²Œì„.">
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="ğŸš© ë•…ë”°ë¨¹ê¸° - ì‹¬ì‹¬í’€ì´ ê²Œì„ ì—°êµ¬ì†Œ">
    <meta property="og:description" content="ì„ ì„ ê·¸ë ¤ ë‚´ ì˜í† ë¥¼ ë„“íˆì„¸ìš”. ê¼¬ë¦¬ë¥¼ ë°Ÿíˆë©´ ì£½ëŠ” ê¸´ì¥ê° ë„˜ì¹˜ëŠ” ëˆˆì¹˜ ì‹¸ì›€!">
    <meta property="og:image" content="https://simsimlabs.com/simsim-games/thumbnail.png">
    <meta property="og:url" content="https://simsimlabs.com/simsim-games/game2.html">

    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* 1. ë ˆì´ì•„ì›ƒ & ë°°ê²½ */
        body { 
            margin: 0; padding: 0; 
            background-color: #f0f2f5; 
            font-family: 'Noto Sans KR', sans-serif;
            color: #333;
            overflow-x: hidden; 
        }

        header {
            background: #2c3e50; color: white; padding: 15px 20px; text-align: center;
        }

        .header-top {
            display: flex; justify-content: space-between; max-width: 1200px; margin: 0 auto 10px; font-size: 0.9rem;
        }
        .header-top a { color: #bdc3c7; text-decoration: none; }

        h1 { margin: 0; font-family: 'Jua', sans-serif; font-size: 1.8rem; }

        /* 2. ê´‘ê³  ì˜ì—­ */
        .ad-banner {
            width: 100%; max-width: 1200px; margin: 20px auto;
            text-align: center; background: #fff; padding: 10px 0;
            border-radius: 8px; overflow: hidden;
        }

        /* 3. ê²Œì„ ì»¨í…Œì´ë„ˆ (ë°˜ì‘í˜•) */
        #game-container-box {
            position: relative;
            width: 100%; 
            max-width: 1280px; 
            height: 720px;     
            margin: 0 auto;
            background-color: #34495e; border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* 4. UI ë ˆì´ì–´ */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; color: white; text-align: center;
        }

        #ui-layer h2 { font-family: 'Jua', sans-serif; font-size: 3.5rem; color: #e74c3c; margin-bottom: 10px; text-shadow: 3px 3px 0 #fff; }
        #ui-layer p { font-size: 1.2rem; color: #ecf0f1; margin-bottom: 30px; line-height: 1.6; }
        
        #start-btn {
            background: #e74c3c; color: white; border: none; padding: 15px 60px;
            font-size: 1.8rem; font-family: 'Jua', sans-serif; border-radius: 50px;
            cursor: pointer; box-shadow: 0 5px 0 #c0392b; transition: transform 0.1s;
        }
        #start-btn:active { transform: translateY(4px); box-shadow: none; }
        #start-btn:hover { background: #ff6b6b; }

        /* 5. HUD (ë­í‚¹, í‚¬ë¡œê·¸) */
        #leaderboard {
            position: absolute; top: 15px; right: 15px;
            background: rgba(0,0,0,0.6); color: white; padding: 15px;
            border-radius: 8px; font-family: 'Jua', sans-serif; font-size: 1rem;
            min-width: 160px; pointer-events: none; z-index: 50;
        }
        #rank-list { list-style: none; padding: 0; margin: 0; }
        #rank-list li { margin-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.2); }

        #kill-log {
            position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%);
            background: rgba(192, 57, 43, 0.9); color: white;
            padding: 10px 30px; border-radius: 30px; font-weight: bold;
            opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 50;
            white-space: nowrap; font-size: 1.1rem;
        }

        /* 6. ëª¨ë°”ì¼ ì¡°ì´ìŠ¤í‹± */
        #joystick-zone {
            position: absolute; bottom: 30px; left: 30px; width: 140px; height: 140px;
            z-index: 90; display: none; 
        }
        #joystick-bg {
            width: 100%; height: 100%; background: rgba(255, 255, 255, 0.15);
            border-radius: 50%; position: relative; border: 2px solid rgba(255,255,255,0.3);
        }
        #joystick-stick {
            width: 60px; height: 60px; background: rgba(255, 255, 255, 0.8);
            border-radius: 50%; position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        /* 7. ì½˜í…ì¸  ì„¤ëª…ê¸€ */
        .content-article {
            max-width: 1200px; margin: 40px auto; padding: 40px;
            background: #fff; border-radius: 12px; line-height: 1.8;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .content-article h2 { color: #e74c3c; border-bottom: 2px solid #ecf0f1; padding-bottom: 10px; margin-top: 30px; }
        .content-article h3 { color: #3498db; margin-top: 25px; }
        .content-article ul { background: #f8f9fa; padding: 20px 40px; border-radius: 8px; }

        /* 8. ê³µìœ  ë²„íŠ¼ */
        .share-bar { text-align: center; margin: 30px 0; }
        .share-btn {
            background: #34495e; color: white; border: none; padding: 12px 25px;
            border-radius: 30px; cursor: pointer; font-size: 1rem; margin: 0 5px;
            transition: 0.2s;
        }
        .share-btn:hover { transform: translateY(-2px); }
        .share-btn.copy { background: #9b59b6; }
        
        #toast {
            visibility: hidden; min-width: 250px; margin-left: -125px;
            background-color: #333; color: #fff; text-align: center;
            border-radius: 2px; padding: 16px; position: fixed; z-index: 1000;
            left: 50%; bottom: 30px; font-size: 17px; opacity: 0; transition: 0.5s;
        }
        #toast.show { visibility: visible; opacity: 1; bottom: 50px; }

        footer { text-align: center; padding: 30px; color: #7f8c8d; font-size: 0.9rem; }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 800px) {
            #game-container-box {
                width: 100%;
                height: 85vh; 
                border-radius: 0;
            }
            #ui-layer h2 { font-size: 2.2rem; }
            .content-article { margin: 20px 10px; padding: 20px; }
            h1 { font-size: 1.4rem; }
        }
    </style>
</head>
<body>

    <header>
        <div class="header-top">
            <a href="en/game2.html">ğŸ‡ºğŸ‡¸ English</a>
            <a href="index.html">ğŸ  ê²Œì„ ëª©ë¡ìœ¼ë¡œ</a>
        </div>
        <h1>ğŸš© ë•…ë”°ë¨¹ê¸°</h1>
    </header>

    <div class="ad-banner">
        <span style="font-size:10px; color:#ccc;">Sponsored</span>
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-2261846676525942"
             data-ad-slot="4380369066"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <div id="game-container-box">
        <canvas id="gameCanvas"></canvas>

        <div id="leaderboard">
            <h3>ğŸ† ë•… ì ìœ ìœ¨</h3>
            <ul id="rank-list"><li>ë¡œë”© ì¤‘...</li></ul>
        </div>

        <div id="kill-log"></div>

        <div id="joystick-zone">
            <div id="joystick-bg">
                <div id="joystick-stick"></div>
            </div>
        </div>

        <div id="ui-layer">
            <h2 id="ui-title">Land Conquer</h2>
            <p id="ui-desc">
                ìì‹ ì˜ ì˜í†  ë°–ìœ¼ë¡œ ë‚˜ê°€ ì„ ì„ ê·¸ë¦¬ì„¸ìš”.<br>
                ì§‘ìœ¼ë¡œ ëŒì•„ì˜¤ë©´ ë‚´ ë•…ì´ ë©ë‹ˆë‹¤! (ê¼¬ë¦¬ ì¡°ì‹¬)
            </p>
            <button id="start-btn">ê²Œì„ ì‹œì‘ â–¶</button>
        </div>
    </div>

    <div class="ad-banner">
        <span style="font-size:10px; color:#ccc;">Sponsored</span>
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-2261846676525942"
             data-ad-slot="4380369066"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <div class="share-bar">
        <button class="share-btn copy" onclick="copyLink()"><i class="fa-solid fa-link"></i> ì¹œêµ¬ì™€ ë§í¬ ê³µìœ </button>
    </div>
    <div id="toast">ğŸ“‹ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>

    <article class="content-article">
        <h2>ğŸ® ë•…ë”°ë¨¹ê¸° (Land Conquer) ê°€ì´ë“œ</h2>
        <p>
            ì¶”ì–µì˜ ë•…ë”°ë¨¹ê¸° ë†€ì´ë¥¼ í˜„ëŒ€ì ì¸ ì›¹ ê²Œì„ìœ¼ë¡œ ì¬í•´ì„í–ˆìŠµë‹ˆë‹¤.
            ìì‹ ì˜ ì˜í†  ë°–ìœ¼ë¡œ ë‚˜ê°€ ì„ ì„ ê·¸ë¦¬ê³ , ë‹¤ì‹œ ë³¸ì§„ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ëŒì•„ì˜¤ë©´ ê·¸ ì˜ì—­ë§Œí¼ ìì‹ ì˜ ë•…ì´ ë©ë‹ˆë‹¤.
            ë§µ ì „ì²´ë¥¼ ìì‹ ì˜ ìƒ‰ê¹”ë¡œ ë®ëŠ” ê²ƒì´ ìµœì¢… ëª©í‘œì…ë‹ˆë‹¤.
        </p>

        <h3>ğŸ•¹ï¸ ìŠ¹ë¦¬ ì „ëµ</h3>
        <ul>
            <li><strong>ê³µê²©:</strong> ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ ì˜í†  ë°–ìœ¼ë¡œ ë‚˜ì™€ ì„ ì„ ê·¸ë¦¬ê³  ìˆì„ ë•Œ, ê·¸ ì„ (ê¼¬ë¦¬)ì„ ë°Ÿìœ¼ë©´ ìƒëŒ€ë¥¼ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            <li><strong>ë°©ì–´:</strong> ìì‹ ì˜ ì˜í†  ì•ˆì—ì„œëŠ” ë¬´ì  ìƒíƒœì…ë‹ˆë‹¤. ìœ„í—˜í•  ë•ŒëŠ” ë³¸ì§„ìœ¼ë¡œ ë¹ ë¥´ê²Œ ë³µê·€í•˜ì„¸ìš”.</li>
            <li><strong>ìë©¸ ì£¼ì˜:</strong> ìì‹ ì˜ ê¼¬ë¦¬ë¥¼ ìŠ¤ìŠ¤ë¡œ ë°Ÿê±°ë‚˜ ë²½ì— ë¶€ë”ªíˆë©´ ê²Œì„ ì˜¤ë²„ë©ë‹ˆë‹¤.</li>
        </ul>

        <h3>ğŸ† ê¿€íŒ</h3>
        <p>
            ìš•ì‹¬ì„ ë¶€ë ¤ í•œ ë²ˆì— ë„“ì€ ë•…ì„ ì°¨ì§€í•˜ë ¤ê³  ë©€ë¦¬ ë‚˜ê°€ë©´ ê³µê²©ë°›ê¸° ì‰½ìŠµë‹ˆë‹¤. 
            <strong>ì¡°ê¸ˆì”© ì•¼ê¸ˆì•¼ê¸ˆ</strong> ì˜í† ë¥¼ ë„“íˆë©° ìƒì¡´ìœ¨ì„ ë†’ì´ëŠ” ê²ƒì´ ê³ ìˆ˜ì˜ ë¹„ê²°ì…ë‹ˆë‹¤.
        </p>
    </article>

    <footer>
        <p>Â© 2024 SimSim Game Labs. All rights reserved.</p>
        <a href="https://simsimlabs.com/privacy.html" style="color:#b2bec3; text-decoration:none;">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
    </footer>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('game-container-box');
        
        const uiLayer = document.getElementById('ui-layer');
        const uiTitle = document.getElementById('ui-title');
        const uiDesc = document.getElementById('ui-desc');
        const startBtn = document.getElementById('start-btn');
        
        const rankList = document.getElementById('rank-list');
        const killLog = document.getElementById('kill-log');
        const joystickZone = document.getElementById('joystick-zone');
        const joystickStick = document.getElementById('joystick-stick');

        // ê²Œì„ ì„¤ì •
        const GRID_SIZE = 25; 
        const MAP_WIDTH = 150; 
        const MAP_HEIGHT = 150;
        
        let map = []; 
        let players = [];
        let gameRunning = false;
        let animationFrameId;
        let frameCount = 0;

        // ì´ë¦„ ìƒì„±ê¸°
        const adjectives = ["ë°°ê³ í”ˆ", "ë„¤ëª¨ë‚œ", "ë¹ ë¥¸", "ìš©ê°í•œ", "ìˆ˜ìƒí•œ", "ì²œì¬", "ë°”ë³´", "ì¦ê±°ìš´", "ê±°ëŒ€í•œ", "ì†Œì‹¬í•œ"];
        const nouns = ["ë•…ë¶€ì", "ê±´ë¬¼ì£¼", "ì§€ë ì´", "ë„¤ëª¨", "íƒ±í¬", "ê°œë¯¸", "ë…ìˆ˜ë¦¬", "í˜¸ë‘ì´", "ê°œë°œì", "ê²Œì´ë¨¸"];
        function getName() { return adjectives[Math.floor(Math.random()*adjectives.length)] + " " + nouns[Math.floor(Math.random()*nouns.length)]; }

        // ì´ˆê¸°í™”
        function init() {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // ëª¨ë°”ì¼ ê°ì§€
            if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
                joystickZone.style.display = 'block';
            }

            if(startBtn) startBtn.addEventListener('click', startGame);
            initJoystick();
            window.addEventListener('keydown', handleKey);
        }

        function resizeCanvas() {
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }

        function startGame() {
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            
            uiLayer.style.display = 'none';
            gameRunning = true;
            frameCount = 0;

            // ë§µ ì´ˆê¸°í™” (0: ë¹ˆ ë•…)
            map = [];
            for(let y=0; y<MAP_HEIGHT; y++) {
                let row = [];
                for(let x=0; x<MAP_WIDTH; x++) row.push(0);
                map.push(row);
            }

            players = [];
            spawnPlayer(1, true); // ë‚˜
            for(let i=2; i<=15; i++) spawnPlayer(i, false); // ë´‡ 14ëª…

            loop();
        }

        function spawnPlayer(id, isHuman) {
            let safe = false;
            let x, y;
            // ì•ˆì „í•œ ìŠ¤í° ìœ„ì¹˜ ì°¾ê¸°
            while(!safe) {
                x = Math.floor(Math.random() * (MAP_WIDTH - 20)) + 10;
                y = Math.floor(Math.random() * (MAP_HEIGHT - 20)) + 10;
                // ì£¼ë³€ì´ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
                if (map[y][x] === 0) safe = true; 
            }
            
            // ì´ˆê¸° ë•… í• ë‹¹ (3x3)
            for(let dy=-1; dy<=1; dy++) {
                for(let dx=-1; dx<=1; dx++) {
                    map[y+dy][x+dx] = id;
                }
            }

            players.push({
                id: id, isHuman: isHuman,
                x: x, y: y, 
                dx: 0, dy: 0, // ì²˜ìŒì—” ì •ì§€
                nextDx: isHuman ? 0 : (Math.random()>0.5 ? 1 : -1), 
                nextDy: isHuman ? 0 : 0,
                color: isHuman ? '#e74c3c' : `hsl(${Math.random()*360}, 70%, 50%)`,
                name: isHuman ? 'ë‚˜ (Player)' : getName(),
                trail: [], 
                score: 9, 
                dead: false,
                aiState: 'expand', // expand, return
                aiTarget: null
            });
        }

        function handleKey(e) {
            if(!gameRunning) return;
            const p = players.find(p => p.isHuman);
            if(!p || p.dead) return;

            // ì—­ë°©í–¥ ì´ë™ ë°©ì§€
            if(e.key === 'ArrowUp' && p.dy !== 1) { p.nextDx = 0; p.nextDy = -1; }
            else if(e.key === 'ArrowDown' && p.dy !== -1) { p.nextDx = 0; p.nextDy = 1; }
            else if(e.key === 'ArrowLeft' && p.dx !== 1) { p.nextDx = -1; p.nextDy = 0; }
            else if(e.key === 'ArrowRight' && p.dx !== -1) { p.nextDx = 1; p.nextDy = 0; }
        }

        function initJoystick() {
            let active = false; let startX, startY;
            const zone = joystickZone;
            
            zone.addEventListener('touchstart', e => {
                e.preventDefault(); active = true;
                let t = e.touches[0]; startX = t.clientX; startY = t.clientY;
                joystickStick.style.transition = 'none';
            }, {passive:false});

            zone.addEventListener('touchmove', e => {
                if(!active) return;
                e.preventDefault();
                let t = e.touches[0];
                let dx = t.clientX - startX; let dy = t.clientY - startY;
                let dist = Math.min(30, Math.sqrt(dx*dx + dy*dy));
                
                // ë°©í–¥ íŒì •
                if(dist > 10) {
                    const p = players.find(p => p.isHuman);
                    if(p && !p.dead) {
                        if(Math.abs(dx) > Math.abs(dy)) {
                            if(dx > 0 && p.dx !== -1) { p.nextDx = 1; p.nextDy = 0; }
                            else if(dx < 0 && p.dx !== 1) { p.nextDx = -1; p.nextDy = 0; }
                        } else {
                            if(dy > 0 && p.dy !== -1) { p.nextDx = 0; p.nextDy = 1; }
                            else if(dy < 0 && p.dy !== 1) { p.nextDx = 0; p.nextDy = -1; }
                        }
                    }
                }
                let angle = Math.atan2(dy, dx);
                joystickStick.style.transform = `translate(-50%, -50%) translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`;
            }, {passive:false});

            zone.addEventListener('touchend', e => {
                e.preventDefault(); active = false;
                joystickStick.style.transform = `translate(-50%, -50%)`;
            });
        }

        // ğŸ¤– ê°œì„ ëœ ë´‡ AI ë¡œì§
        function updateBotAI(p) {
            // 1. ì£½ìŒ ë°©ì§€ (ë²½/ìê¸°ê¼¬ë¦¬ íšŒí”¼)
            let safeMoves = [];
            const moves = [{dx:0, dy:-1}, {dx:0, dy:1}, {dx:-1, dy:0}, {dx:1, dy:0}];
            
            moves.forEach(m => {
                // ì—­ë°©í–¥ ì œì™¸
                if (m.dx === -p.dx && m.dy === -p.dy && (p.dx !== 0 || p.dy !== 0)) return;

                let nx = p.x + m.dx;
                let ny = p.y + m.dy;

                // ë§µ ë°–ì¸ì§€ í™•ì¸
                if (nx < 0 || nx >= MAP_WIDTH || ny < 0 || ny >= MAP_HEIGHT) return;
                
                // ìê¸° ê¼¬ë¦¬ ë°ŸëŠ”ì§€ í™•ì¸
                if (p.trail.some(t => t.x === nx && t.y === ny)) return;

                safeMoves.push(m);
            });

            if (safeMoves.length === 0) return; // ì£½ì„ ìš´ëª…...

            // 2. ìƒíƒœ ê²°ì • (í™•ì¥ vs ë³µê·€)
            // ê¼¬ë¦¬ê°€ ë„ˆë¬´ ê¸¸ì–´ì§€ë©´(10ì¹¸ ì´ìƒ) ì§‘ìœ¼ë¡œ ë³µê·€ ì‹œë„
            if (p.trail.length > 10 || Math.random() < 0.02) {
                p.aiState = 'return';
            } else if (p.trail.length === 0) {
                p.aiState = 'expand';
            }

            // 3. ëª©í‘œ ë°©í–¥ ì„¤ì •
            let bestMove = safeMoves[Math.floor(Math.random() * safeMoves.length)]; // ê¸°ë³¸ ëœë¤

            if (p.aiState === 'return' && p.trail.length > 0) {
                // ë‚´ ë•… ì¤‘ ê°€ì¥ ê°€ê¹Œìš´ ê³³ ì°¾ê¸° (ë‹¨ìˆœí™”: í˜„ì¬ ìœ„ì¹˜ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ ë‚´ ë•… ì¢Œí‘œ)
                // ì„±ëŠ¥ìƒ ì „ì²´ ê²€ìƒ‰ì€ ë¬´ë¦¬ì´ë¯€ë¡œ, í˜„ì¬ ë°©í–¥ ìœ ì§€ + ì•½ê°„ì˜ ëœë¤ì„±
                // ì—¬ê¸°ì„œëŠ” "ë‚´ ê¼¬ë¦¬ê°€ ì•„ë‹Œ ë‚´ ë•…"ìœ¼ë¡œ ì´ë™í•´ì•¼ í•¨.
                // *ê°„ë‹¨í•œ ë¡œì§:* ëœë¤í•˜ê²Œ ì›€ì§ì´ë˜, map[y][x] == p.id ì¸ ê³³ì„ ë°œê²¬í•˜ë©´ ê·¸ìª½ ì„ í˜¸
            }

            // ë°©í–¥ ì „í™˜ (ë„ˆë¬´ ìì£¼ ë°”ê¾¸ì§€ ì•Šê²Œ)
            if (Math.random() < 0.1 || (p.dx === 0 && p.dy === 0)) {
                p.nextDx = bestMove.dx;
                p.nextDy = bestMove.dy;
            }
        }

        function loop() {
            if(!gameRunning) return;
            
            // ì†ë„ ì¡°ì ˆ (í”„ë ˆì„ ìŠ¤í‚µ)
            frameCount++;
            if(frameCount % 4 === 0) { // 60fps / 4 = 15 updates per sec
                update();
            }
            
            draw();
            animationFrameId = requestAnimationFrame(loop);
        }

        function update() {
            players.forEach(p => {
                if(p.dead) return;

                if(!p.isHuman) {
                    updateBotAI(p);
                }

                // í˜„ì¬ ì´ë™ ë°©í–¥ ì ìš©
                p.dx = p.nextDx; 
                p.dy = p.nextDy;

                // ì •ì§€ ìƒíƒœë©´ ì²˜ë¦¬ ì•ˆí•¨
                if(p.dx === 0 && p.dy === 0) return;

                let nx = p.x + p.dx; 
                let ny = p.y + p.dy;

                // 1. ë²½ ì¶©ëŒ ì²´í¬
                if(nx < 0 || nx >= MAP_WIDTH || ny < 0 || ny >= MAP_HEIGHT) { 
                    killPlayer(p, "ë²½ ì¶©ëŒ"); return; 
                }

                // 2. ìê¸° ê¼¬ë¦¬ ì¶©ëŒ ì²´í¬
                if(p.trail.some(t => t.x === nx && t.y === ny)) { 
                    killPlayer(p, "ìê¸° ê¼¬ë¦¬ ë°ŸìŒ"); return; 
                }

                // 3. ë‹¤ë¥¸ í”Œë ˆì´ì–´ì™€ì˜ ì¶©ëŒ ì²´í¬
                players.forEach(other => {
                    if(p === other || other.dead) return;
                    
                    // ë‚´ê°€ ë‚¨ì˜ ê¼¬ë¦¬ë¥¼ ë°ŸìŒ -> ìƒëŒ€ ì‚¬ë§
                    if(other.trail.some(t => t.x === nx && t.y === ny)) {
                        killPlayer(other, `${p.name}ì—ê²Œ ê¼¬ë¦¬ ë°Ÿí˜`);
                        if(p.isHuman) showKillLog(`${other.name} ì œê±°!`);
                    }
                    
                    // ë¨¸ë¦¬ë¼ë¦¬ ì¶©ëŒ -> ë‘˜ ë‹¤ ì‚¬ë§
                    if(other.x === nx && other.y === ny) {
                        killPlayer(p, "ì •ë©´ ì¶©ëŒ");
                        killPlayer(other, "ì •ë©´ ì¶©ëŒ");
                    }
                });

                if(p.dead) return;

                // ìœ„ì¹˜ ì—…ë°ì´íŠ¸
                p.x = nx; 
                p.y = ny;

                // 4. ë•… ì±„ìš°ê¸° ë¡œì§
                // ë‚´ ë•…ì— ë„ì°©í–ˆëŠ”ê°€?
                if(map[ny][nx] === p.id) {
                    if(p.trail.length > 0) {
                        // ê¼¬ë¦¬ë¥¼ ë‚´ ë•…ìœ¼ë¡œ ë³€ê²½
                        p.trail.forEach(t => map[t.y][t.x] = p.id);
                        
                        // [ê°„ë‹¨í•œ ì±„ìš°ê¸° ì•Œê³ ë¦¬ì¦˜]
                        // ê¼¬ë¦¬ì˜ ìµœì†Œ/ìµœëŒ€ ì¢Œí‘œë¥¼ êµ¬í•´ ê·¸ ì‚¬ê°í˜• ì•ˆì„ í›‘ìœ¼ë©´ì„œ
                        // ê¼¬ë¦¬ ë‚´ë¶€ë¼ê³  íŒë‹¨ë˜ëŠ” ê³³ì„ ë‚´ ë•…ìœ¼ë¡œ ë§Œë“¦.
                        // *ì™„ë²½í•œ Flood Fillì€ ì•„ë‹ˆì§€ë§Œ ì›¹ê²Œì„ìš©ìœ¼ë¡œ ì¶©ë¶„íˆ ë¹ ë¦„*
                        let minX = p.x, maxX = p.x, minY = p.y, maxY = p.y;
                        p.trail.forEach(t => {
                            minX = Math.min(minX, t.x); maxX = Math.max(maxX, t.x);
                            minY = Math.min(minY, t.y); maxY = Math.max(maxY, t.y);
                        });

                        // ì‚¬ê°í˜• ë‚´ë¶€ ì±„ìš°ê¸° (ë‹¨ìˆœí™”: íŠ¸ë ˆì¼ë¡œ ë‘˜ëŸ¬ì‹¸ì¸ ë¹ˆ ê³µê°„ë„ ë‚´ ë•…)
                        // ì •êµí•œ í´ë¦¬ê³¤ í•„ì€ ë³µì¡í•˜ë¯€ë¡œ, ì—¬ê¸°ì„  'ê¼¬ë¦¬ ê¶¤ì  + ê·¸ ì‚¬ì´'ë¥¼ ëŒ€ëµì ìœ¼ë¡œ ì±„ì›€
                        for(let cy = minY; cy <= maxY; cy++) {
                            for(let cx = minX; cx <= maxX; cx++) {
                                // ì´ë¯¸ ëˆ„êµ¬ ë•…ì´ë©´ íŒ¨ìŠ¤í•˜ê±°ë‚˜ ëºìŒ (ì—¬ê¸°ì„  ëºê¸° ê°€ëŠ¥)
                                if (map[cy][cx] !== p.id) {
                                    // ë¹ˆ ë•…ì´ê±°ë‚˜ ë‚¨ì˜ ë•…ì´ë©´ ë‚´ ë•…ìœ¼ë¡œ (ë‹¨ìˆœ ì‚¬ê° ì±„ìš°ê¸°)
                                    // ì‹¤ì œë¡œëŠ” ì™¸ê³½ì„  ë‚´ë¶€ì¸ì§€ íŒë³„í•´ì•¼ í•˜ì§€ë§Œ, ìºì£¼ì–¼í•˜ê²Œ ì‚¬ê°ë²”ìœ„ë¡œ ì²˜ë¦¬
                                    // ì¢€ ë” ê²Œì„ì„±ì„ ìœ„í•´: ê¼¬ë¦¬ ê¶¤ì  ë‚´ë¶€ë§Œ ì±„ìš°ë„ë¡ ê°œì„  í•„ìš”í•˜ì§€ë§Œ
                                    // ì„±ëŠ¥ìƒ ì´ì •ë„ë¡œ íƒ€í˜‘
                                    map[cy][cx] = p.id; 
                                }
                            }
                        }

                        p.trail = []; // ê¼¬ë¦¬ ì´ˆê¸°í™”
                        p.score = countScore(p.id); // ì ìˆ˜ ê°±ì‹ 
                    }
                } else {
                    // ë‚´ ë•…ì´ ì•„ë‹ˆë©´ ê¼¬ë¦¬ ëŠ˜ë¦¬ê¸°
                    p.trail.push({x: nx, y: ny});
                }
            });
            updateLeaderboard();
        }

        function killPlayer(p, reason) {
            p.dead = true;
            // ë§µì—ì„œ ë•… ì§€ìš°ê¸° (ì„ íƒì‚¬í•­: ì£½ìœ¼ë©´ ë•…ì´ ì‚¬ë¼ì§€ê²Œ í• ì§€, ë‚¨ê¸¸ì§€. ë³´í†µ ë‚¨ê¹€)
            // p.trail(ê¼¬ë¦¬)ì€ ì¦‰ì‹œ ì‚¬ë¼ì ¸ì•¼ í•¨
            p.trail = [];
            
            if(p.isHuman) {
                gameOver(reason);
            } else {
                // ë´‡ì€ 2ì´ˆ í›„ ë¶€í™œ
                setTimeout(() => { 
                    if(gameRunning) spawnPlayer(p.id, false); 
                }, 2000);
            }
        }

        function countScore(id) {
            let s = 0;
            // ì „ì²´ ë§µ ìŠ¤ìº” (ìµœì í™”ë¥¼ ìœ„í•´ ê°€ë”ë§Œ í•˜ê±°ë‚˜ ë°©ì‹ ë³€ê²½ ê°€ëŠ¥)
            // ì—¬ê¸°ì„  ì •í™•ë„ë¥¼ ìœ„í•´ ë§¤ë²ˆ ê³„ì‚°í•˜ì§€ë§Œ, ë§µì´ í¬ë©´ ëŠë ¤ì§ˆ ìˆ˜ ìˆìŒ.
            // 4000ì¹¸ ì •ë„ëŠ” ê´œì°®ìŒ.
            for(let y=0; y<MAP_HEIGHT; y++) {
                for(let x=0; x<MAP_WIDTH; x++) {
                    if(map[y][x] === id) s++;
                }
            }
            return s;
        }

        function draw() {
            // ì¹´ë©”ë¼ ì„¤ì • (í”Œë ˆì´ì–´ ë”°ë¼ê°€ê¸°)
            const p = players.find(pl => pl.isHuman);
            if(!p) return; // í”Œë ˆì´ì–´ ì£½ì—ˆìœ¼ë©´ ë§ˆì§€ë§‰ ìœ„ì¹˜ or ì •ì§€

            ctx.setTransform(1, 0, 0, 1, 0, 0); 
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ì¹´ë©”ë¼ ìœ„ì¹˜ ê³„ì‚°
            let camX = p.x * GRID_SIZE - canvas.width / 2;
            let camY = p.y * GRID_SIZE - canvas.height / 2;
            
            // ë§µ ë°–ì„ ë³´ì—¬ì£¼ì§€ ì•Šë„ë¡ í´ë¨í•‘
            camX = Math.max(0, Math.min(camX, MAP_WIDTH * GRID_SIZE - canvas.width));
            camY = Math.max(0, Math.min(camY, MAP_HEIGHT * GRID_SIZE - canvas.height));

            ctx.translate(-camX, -camY);

            // ë§µ ê²½ê³„ì„ 
            ctx.strokeStyle = '#7f8c8d';
            ctx.lineWidth = 5;
            ctx.strokeRect(0, 0, MAP_WIDTH * GRID_SIZE, MAP_HEIGHT * GRID_SIZE);

            // í™”ë©´ì— ë³´ì´ëŠ” ì˜ì—­ë§Œ ê·¸ë¦¬ê¸° (Culling)
            let startCol = Math.floor(camX / GRID_SIZE);
            let endCol = startCol + (canvas.width / GRID_SIZE) + 1;
            let startRow = Math.floor(camY / GRID_SIZE);
            let endRow = startRow + (canvas.height / GRID_SIZE) + 1;

            // ë•… ê·¸ë¦¬ê¸°
            for(let y = Math.max(0, startRow); y < Math.min(MAP_HEIGHT, endRow); y++) {
                for(let x = Math.max(0, startCol); x < Math.min(MAP_WIDTH, endCol); x++) {
                    let id = map[y][x];
                    if(id !== 0) {
                        let owner = players.find(pl => pl.id === id);
                        if(owner) {
                            ctx.fillStyle = owner.color;
                            ctx.globalAlpha = 0.5; // ë•…ì€ ë°˜íˆ¬ëª…
                            ctx.fillRect(x*GRID_SIZE, y*GRID_SIZE, GRID_SIZE, GRID_SIZE);
                            ctx.globalAlpha = 1.0;
                        }
                    }
                }
            }

            // í”Œë ˆì´ì–´ & ê¼¬ë¦¬ ê·¸ë¦¬ê¸°
            players.forEach(pl => {
                if(pl.dead) return;

                // ê¼¬ë¦¬
                ctx.fillStyle = pl.color;
                ctx.globalAlpha = 0.8;
                pl.trail.forEach(t => {
                    ctx.fillRect(t.x*GRID_SIZE, t.y*GRID_SIZE, GRID_SIZE, GRID_SIZE);
                });
                ctx.globalAlpha = 1.0;

                // ë³¸ì²´ (ë¨¸ë¦¬)
                ctx.shadowBlur = 10;
                ctx.shadowColor = 'black';
                ctx.fillStyle = pl.color;
                ctx.fillRect(pl.x*GRID_SIZE, pl.y*GRID_SIZE, GRID_SIZE, GRID_SIZE);
                ctx.shadowBlur = 0;

                // ì´ë¦„
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 12px Noto Sans KR';
                ctx.textAlign = 'center';
                ctx.fillText(pl.name, pl.x*GRID_SIZE + GRID_SIZE/2, pl.y*GRID_SIZE - 5);
            });
        }

        function showKillLog(msg) {
            killLog.innerText = msg; killLog.style.opacity = 1;
            setTimeout(() => { killLog.style.opacity = 0; }, 2000);
        }

        function updateLeaderboard() {
            let list = [...players].sort((a,b) => b.score - a.score);
            let html = '';
            for(let i=0; i<Math.min(5, list.length); i++) {
                let p = list[i];
                let name = p.isHuman ? `<span style="color:#fd79a8">${p.name}</span>` : p.name;
                html += `<li>${i+1}. ${name} <small>(${p.score})</small></li>`;
            }
            rankList.innerHTML = html;
        }

        function gameOver(reason) {
            gameRunning = false;
            cancelAnimationFrame(animationFrameId);
            ingameAd.style.display = 'none';
            uiLayer.style.display = 'flex';
            
            const btn = document.getElementById('start-btn');
            btn.innerText = "ë‹¤ì‹œ ë„ì „í•˜ê¸° â†º";
            
            document.getElementById('ui-title').innerText = "ğŸ’€ ê²Œì„ ì˜¤ë²„";
            const p = players.find(p => p.isHuman);
            document.getElementById('ui-desc').innerHTML = `
                ì‚¬ë§ ì›ì¸: <b>${reason}</b><br>
                ìµœì¢… ë•… í¬ê¸°: <span style="color:#e74c3c; font-weight:bold;">${p ? p.score : 0}</span>ì¹¸
            `;
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                const toast = document.getElementById("toast");
                toast.className = "show";
                setTimeout(() => toast.className = toast.className.replace("show", ""), 3000);
            });
        }

        // Run
        init();
    </script>
</body>
</html>
