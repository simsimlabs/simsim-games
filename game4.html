<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë¸”ë™í™€ í‚¤ìš°ê¸° - ì‹¬ì‹¬í’€ì´ ê²Œì„ ì—°êµ¬ì†Œ</title>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2261846676525942" crossorigin="anonymous"></script>
    
    <link rel="canonical" href="https://simsimlabs.com/simsim-games/game4.html">

    <meta name="description" content="ë¸”ë™í™€ í‚¤ìš°ê¸°(Black Hole.io) ë¬´ë£Œ ì›¹ê²Œì„. ë„ì‹œì˜ ê±´ë¬¼, ìë™ì°¨, ì‚¬ëŒì„ ì‚¼ì¼œ ê±°ëŒ€í•´ì§€ì„¸ìš”. ì„¤ì¹˜ ì—†ëŠ” 2.5D ì•¡ì…˜ ê²Œì„.">
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="ğŸ•³ï¸ ë¸”ë™í™€ í‚¤ìš°ê¸° - ì‹¬ì‹¬í’€ì´ ê²Œì„ ì—°êµ¬ì†Œ">
    <meta property="og:description" content="ë„ì‹œì˜ ëª¨ë“  ê²ƒì„ ë¹¨ì•„ë“¤ì´ì„¸ìš”! ì‚¬ëŒ, ìë™ì°¨, ê±´ë¬¼ê¹Œì§€... ë¬´ì—‡ì´ë“  ì‚¼í‚¤ëŠ” ê±°ëŒ€ ë¸”ë™í™€ì´ ë˜ì–´ë³´ì„¸ìš”.">
    <meta property="og:image" content="https://simsimlabs.com/simsim-games/thumbnail.png">
    <meta property="og:url" content="https://simsimlabs.com/simsim-games/game4.html">

    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* 1. ë ˆì´ì•„ì›ƒ & ë°°ê²½ */
        body { 
            margin: 0; padding: 0; 
            background-color: #f0f2f5; 
            font-family: 'Noto Sans KR', sans-serif;
            color: #333;
            overflow-x: hidden; 
        }

        header {
            background: #2c3e50; color: white; padding: 15px 20px; text-align: center;
        }

        .header-top {
            display: flex; justify-content: space-between; max-width: 1200px; margin: 0 auto 10px; font-size: 0.9rem;
        }
        .header-top a { color: #bdc3c7; text-decoration: none; }

        h1 { margin: 0; font-family: 'Jua', sans-serif; font-size: 1.8rem; }

        /* 2. ê´‘ê³  ì˜ì—­ */
        .ad-banner {
            width: 100%; max-width: 1200px; margin: 20px auto;
            text-align: center; background: #fff; padding: 10px 0;
            border-radius: 8px; overflow: hidden;
        }

        /* 3. ê²Œì„ ì»¨í…Œì´ë„ˆ (ë°˜ì‘í˜•) */
        #game-container-box {
            position: relative;
            width: 100%; 
            max-width: 1280px; 
            height: 720px;     
            margin: 0 auto;
            background-color: #34495e; border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* 4. UI ë ˆì´ì–´ */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; color: white; text-align: center;
        }

        #ui-layer h2 { font-family: 'Jua', sans-serif; font-size: 3.5rem; color: #6c5ce7; margin-bottom: 10px; text-shadow: 3px 3px 0 #fff; }
        #ui-layer p { font-size: 1.2rem; color: #bdc3c7; margin-bottom: 30px; line-height: 1.6; }
        
        #start-btn {
            background: #6c5ce7; color: white; border: none; padding: 15px 60px;
            font-size: 1.8rem; font-family: 'Jua', sans-serif; border-radius: 50px;
            cursor: pointer; box-shadow: 0 5px 0 #5f27cd; transition: transform 0.1s;
        }
        #start-btn:active { transform: translateY(4px); box-shadow: none; }
        #start-btn:hover { background: #8e44ad; }

        /* 5. HUD */
        #leaderboard {
            position: absolute; top: 15px; right: 15px;
            background: rgba(0,0,0,0.6); color: white; padding: 15px;
            border-radius: 8px; font-family: 'Jua', sans-serif; font-size: 1rem;
            min-width: 160px; pointer-events: none; z-index: 50;
        }
        #rank-list { list-style: none; padding: 0; margin: 0; }
        #rank-list li { margin-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.2); }

        #score-box {
            position: absolute; top: 15px; left: 15px;
            color: white; font-family: 'Jua', sans-serif; font-size: 1.5rem;
            text-shadow: 2px 2px 0 #000; pointer-events: none; z-index: 50;
        }

        #kill-log {
            position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%);
            background: rgba(44, 62, 80, 0.9); color: white;
            padding: 10px 30px; border-radius: 30px; font-weight: bold;
            opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 50;
            white-space: nowrap; font-size: 1.1rem;
        }

        /* 6. ëª¨ë°”ì¼ ì¡°ì´ìŠ¤í‹± */
        #joystick-zone {
            position: absolute; bottom: 30px; left: 30px; width: 140px; height: 140px;
            z-index: 90; display: none; 
        }
        #joystick-bg {
            width: 100%; height: 100%; background: rgba(255, 255, 255, 0.15);
            border-radius: 50%; position: relative; border: 2px solid rgba(255,255,255,0.3);
        }
        #joystick-stick {
            width: 60px; height: 60px; background: rgba(255, 255, 255, 0.8);
            border-radius: 50%; position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        /* 7. ì½˜í…ì¸  ì„¤ëª…ê¸€ */
        .content-article {
            max-width: 1200px; margin: 40px auto; padding: 40px;
            background: #fff; border-radius: 12px; line-height: 1.8;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .content-article h2 { color: #6c5ce7; border-bottom: 2px solid #f1f2f6; padding-bottom: 10px; margin-top: 30px; }
        .content-article h3 { color: #0984e3; margin-top: 25px; }
        .content-article ul { background: #f8f9fa; padding: 20px 40px; border-radius: 8px; }

        /* 8. ê³µìœ  ë²„íŠ¼ */
        .share-bar { text-align: center; margin: 30px 0; }
        .share-btn {
            background: #34495e; color: white; border: none; padding: 12px 25px;
            border-radius: 30px; cursor: pointer; font-size: 1rem; margin: 0 5px;
            transition: 0.2s;
        }
        .share-btn:hover { transform: translateY(-2px); }
        .share-btn.copy { background: #6c5ce7; }
        
        #toast {
            visibility: hidden; min-width: 250px; margin-left: -125px;
            background-color: #333; color: #fff; text-align: center;
            border-radius: 2px; padding: 16px; position: fixed; z-index: 1000;
            left: 50%; bottom: 30px; font-size: 17px; opacity: 0; transition: 0.5s;
        }
        #toast.show { visibility: visible; opacity: 1; bottom: 50px; }

        footer { text-align: center; padding: 30px; color: #7f8c8d; font-size: 0.9rem; }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 800px) {
            #game-container-box {
                width: 100%;
                height: 85vh; 
                border-radius: 0;
            }
            #ui-layer h2 { font-size: 2.2rem; }
            .content-article { margin: 20px 10px; padding: 20px; }
            h1 { font-size: 1.4rem; }
        }
    </style>
</head>
<body>

    <header>
        <div class="header-top">
            <a href="en/game4.html">ğŸ‡ºğŸ‡¸ English</a>
            <a href="index.html">ğŸ  ê²Œì„ ëª©ë¡ìœ¼ë¡œ</a>
        </div>
        <h1>ğŸ•³ï¸ ë¸”ë™í™€ í‚¤ìš°ê¸°</h1>
    </header>

    <div class="ad-banner">
        <span style="font-size:10px; color:#ccc;">Sponsored</span>
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-2261846676525942"
             data-ad-slot="4380369066"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <div id="game-container-box">
        <canvas id="gameCanvas"></canvas>

        <div id="score-box">ì ìˆ˜: 0</div>

        <div id="leaderboard">
            <h3>ğŸ† ë­í‚¹ Top 5</h3>
            <ul id="rank-list"><li>Loading...</li></ul>
        </div>

        <div id="kill-log"></div>

        <div id="joystick-zone">
            <div id="joystick-bg">
                <div id="joystick-stick"></div>
            </div>
        </div>

        <div id="ui-layer">
            <h2 id="ui-title">Black Hole</h2>
            <p id="ui-desc">
                ë„ì‹œì˜ ëª¨ë“  ê²ƒì„ ë¹¨ì•„ë“¤ì´ì„¸ìš”!<br>
                ì‚¬ëŒ â†’ ìë™ì°¨ â†’ ê±´ë¬¼ ìˆœìœ¼ë¡œ ë¨¹ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
            <button id="start-btn">ê²Œì„ ì‹œì‘ â–¶</button>
        </div>
    </div>

    <div class="ad-banner">
        <span style="font-size:10px; color:#ccc;">Sponsored</span>
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-2261846676525942"
             data-ad-slot="4380369066"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <div class="share-bar">
        <button class="share-btn copy" onclick="copyLink()"><i class="fa-solid fa-link"></i> ì¹œêµ¬ì™€ ë§í¬ ê³µìœ </button>
    </div>
    <div id="toast">ğŸ“‹ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>

    <article class="content-article">
        <h2>ğŸ® ë¸”ë™í™€ í‚¤ìš°ê¸° (Hole.io ìŠ¤íƒ€ì¼) ê°€ì´ë“œ</h2>
        <p>
            ì‘ì€ ì‹±í¬í™€ë¡œ ì‹œì‘í•´ ë„ì‹œ ì „ì²´ë¥¼ ì§‘ì–´ì‚¼í‚¤ëŠ” ê´´ë¬¼ ë¸”ë™í™€ë¡œ ì„±ì¥í•˜ì„¸ìš”!
            ì²˜ìŒì—ëŠ” í‘œì§€íŒì´ë‚˜ ì‚¬ëŒ ê°™ì€ ì‘ì€ ë¬¼ì²´ë§Œ ë¨¹ì„ ìˆ˜ ìˆì§€ë§Œ, í¬ê¸°ê°€ ì»¤ì§ˆìˆ˜ë¡ ìë™ì°¨, ì§‘, ì‹¬ì§€ì–´ ê±°ëŒ€í•œ ë¹Œë”©ê¹Œì§€ ì‚¼í‚¬ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.
            ì œí•œ ì‹œê°„ ë‚´ì— ê°€ì¥ ê±°ëŒ€í•œ ë¸”ë™í™€ì´ ë˜ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.
        </p>

        <h3>ğŸ•¹ï¸ ì¡°ì‘ ë°©ë²•</h3>
        <ul>
            <li><strong>PC:</strong> ë§ˆìš°ìŠ¤ ì»¤ì„œê°€ ê°€ë¦¬í‚¤ëŠ” ë°©í–¥ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.</li>
            <li><strong>ëª¨ë°”ì¼:</strong> í™”ë©´ ì¢Œì¸¡ í•˜ë‹¨ì˜ ê°€ìƒ ì¡°ì´ìŠ¤í‹±ì„ ë“œë˜ê·¸í•˜ì—¬ ì´ë™í•©ë‹ˆë‹¤.</li>
            <li><strong>ê·œì¹™:</strong> ë‚˜ë³´ë‹¤ ì‘ì€ ë¸”ë™í™€ì€ ì¡ì•„ë¨¹ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í° ë¸”ë™í™€ì€ í”¼í•˜ì„¸ìš”!</li>
        </ul>

        <h3>ğŸ† ê³ ë“ì  ë¹„ë²•</h3>
        <p>
            1. <strong>ì´ˆë°˜ ëŸ¬ì‹œ:</strong> ê²Œì„ ì‹œì‘ ì§í›„ì—ëŠ” ê³µì›ì´ë‚˜ ì£¼ì°¨ì¥ìœ¼ë¡œ ë‹¬ë ¤ê°€ì„¸ìš”. íœìŠ¤, ê¼¬ê¹”ì½˜ ê°™ì€ ì‘ì€ ë¬¼ì²´ê°€ ë°€ì§‘ëœ ê³³ì´ ì„±ì¥í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤.<br><br>
            2. <strong>ë‹¨ê³„ë³„ ì„±ì¥:</strong> ë¬´ë¦¬í•´ì„œ í° ê±´ë¬¼ì„ ë…¸ë¦¬ì§€ ë§ˆì„¸ìš”. ì… í¬ê¸°ì— ë”± ë§ëŠ” ë¬¼ì²´ë¥¼ ì—°ì†ìœ¼ë¡œ í¡ì…í•˜ëŠ” ê²ƒì´ ê°€ì¥ ë¹ ë¦…ë‹ˆë‹¤.<br><br>
            3. <strong>ì‚¬ëƒ¥:</strong> ì–´ëŠ ì •ë„ ì»¤ì¡Œë‹¤ë©´ ë‹¤ë¥¸ í”Œë ˆì´ì–´ë¥¼ ë…¸ë¦¬ì„¸ìš”. ìƒëŒ€ë¥¼ í¡ìˆ˜í•˜ë©´ ëŒ€ëŸ‰ì˜ ì ìˆ˜ë¥¼ í•œ ë²ˆì— ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
    </article>

    <footer>
        <p>Â© 2024 SimSim Game Labs. All rights reserved.</p>
        <a href="https://simsimlabs.com/privacy.html" style="color:#b2bec3; text-decoration:none;">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
    </footer>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('game-container-box');
        
        const uiLayer = document.getElementById('ui-layer');
        const uiTitle = document.getElementById('ui-title');
        const uiDesc = document.getElementById('ui-desc');
        const startBtn = document.getElementById('start-btn');
        const scoreBox = document.getElementById('score-box');
        
        const rankList = document.getElementById('rank-list');
        const killLog = document.getElementById('kill-log');
        const joystickZone = document.getElementById('joystick-zone');
        const joystickStick = document.getElementById('joystick-stick');

        // ê²Œì„ ì„¤ì •
        const MAP_SIZE = 4000;
        const PROP_COUNT = 1500;
        const BOT_COUNT = 15;
        const MAP_COLOR = '#ecf0f1';
        
        let holes = [];
        let props = [];
        let gameRunning = false;
        let animationFrameId;
        
        let playerIndex = -1;
        let mouseX = 0, mouseY = 0;
        let inputType = 'mouse';
        let joystickVector = { x: 0, y: 0 };
        let joystickActive = false;

        // ì´ë¦„ ë°ì´í„°
        const adjectives = ["ë°°ê³ í”ˆ", "ê±°ëŒ€í•œ", "ë¬´ì„œìš´", "ê°•ë ¥í•œ", "ì‹¬ì—°ì˜", "ìš°ì£¼", "ì–´ë‘ ì˜", "ì‹ ë¹„í•œ", "íƒìš•ì˜", "í­ì£¼í•˜ëŠ”"];
        const nouns = ["ë¸”ë™í™€", "ì‹±í¬í™€", "ì²­ì†Œê¸°", "ê´´ë¬¼", "í¬ì‹ì", "ë³´ì´ë“œ", "êµ¬ë©", "íƒœí’", "ì‹¬ì¥", "ê·¸ë¦¼ì"];
        function generateName() { return adjectives[Math.floor(Math.random()*adjectives.length)] + " " + nouns[Math.floor(Math.random()*nouns.length)]; }

        // ì‚¬ë¬¼ ë°ì´í„° (2.5D íš¨ê³¼ë¥¼ ìœ„í•œ ìƒ‰ìƒ ì„¸íŠ¸)
        // type: 0(ì†Œí˜•), 1(ì¤‘í˜•), 2(ëŒ€í˜•), 3(ì´ˆëŒ€í˜•)
        // r: ë°˜ì§€ë¦„(í¬ê¸°), h: ë†’ì´(ì…ì²´ê°), score: ì ìˆ˜
        const PROP_TYPES = [
            { id: 0, r: 6, h: 4, score: 1, color: '#e67e22', side: '#d35400', name: 'ê¼¬ê¹”' },
            { id: 1, r: 8, h: 10, score: 2, color: '#2ecc71', side: '#27ae60', name: 'ì‚¬ëŒ' },
            { id: 2, r: 15, h: 8, score: 5, color: '#3498db', side: '#2980b9', name: 'ìë™ì°¨' },
            { id: 3, r: 30, h: 30, score: 20, color: '#95a5a6', side: '#7f8c8d', name: 'ì§‘' },
            { id: 4, r: 50, h: 60, score: 50, color: '#34495e', side: '#2c3e50', name: 'ë¹Œë”©' }
        ];

        function init() {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // ëª¨ë°”ì¼ ê°ì§€
            if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
                joystickZone.style.display = 'block';
                inputType = 'joystick';
                initJoystick();
            }

            container.addEventListener('mousemove', e => {
                if(inputType !== 'joystick') {
                    const rect = canvas.getBoundingClientRect();
                    const scaleX = canvas.width / rect.width;
                    const scaleY = canvas.height / rect.height;
                    mouseX = (e.clientX - rect.left) * scaleX - canvas.width / 2;
                    mouseY = (e.clientY - rect.top) * scaleY - canvas.height / 2;
                }
            });

            container.addEventListener('mousedown', () => { if(inputType !== 'joystick') inputType = 'mouse'; });
            startBtn.addEventListener('click', startGame);
        }

        function resizeCanvas() {
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }

        function initJoystick() {
            let startX, startY;
            const maxDist = 35;
            
            joystickZone.addEventListener('touchstart', e => {
                e.preventDefault();
                joystickActive = true;
                let t = e.touches[0];
                startX = t.clientX;
                startY = t.clientY;
                joystickStick.style.transition = 'none';
            });

            joystickZone.addEventListener('touchmove', e => {
                if(!joystickActive) return;
                e.preventDefault();
                let t = e.touches[0];
                let dx = t.clientX - startX;
                let dy = t.clientY - startY;
                let dist = Math.min(maxDist, Math.hypot(dx, dy));
                let angle = Math.atan2(dy, dx);
                
                // ë²¡í„° ì •ê·œí™”
                joystickVector = { 
                    x: Math.cos(angle) * (dist/maxDist), 
                    y: Math.sin(angle) * (dist/maxDist) 
                };

                joystickStick.style.transform = `translate(-50%, -50%) translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`;
            });

            joystickZone.addEventListener('touchend', e => {
                e.preventDefault();
                joystickActive = false;
                joystickVector = { x: 0, y: 0 };
                joystickStick.style.transform = `translate(-50%, -50%)`;
            });
        }

        function startGame() {
            if(animationFrameId) cancelAnimationFrame(animationFrameId);
            uiLayer.style.display = 'none';
            gameRunning = true;
            
            holes = [];
            props = [];

            // ì‚¬ë¬¼ ìƒì„±
            for(let i=0; i<PROP_COUNT; i++) addProp();

            // í”Œë ˆì´ì–´
            playerIndex = addHole(true);
            
            // ë´‡
            for(let i=0; i<BOT_COUNT; i++) addHole(false);

            loop();
        }

        function addProp() {
            let rand = Math.random();
            let typeIdx = 0;
            // í™•ë¥  ì¡°ì •: ì‘ì€ ê²ƒì´ ë” ë§ì´ ë‚˜ì˜´
            if (rand < 0.4) typeIdx = 0;
            else if (rand < 0.7) typeIdx = 1;
            else if (rand < 0.9) typeIdx = 2;
            else if (rand < 0.98) typeIdx = 3;
            else typeIdx = 4;

            let type = PROP_TYPES[typeIdx];
            
            props.push({
                x: Math.random() * MAP_SIZE,
                y: Math.random() * MAP_SIZE,
                ...type,
                // 2.5D íš¨ê³¼ë¥¼ ìœ„í•œ ëœë¤ íšŒì „ (ë‹¨, ë¹Œë”©ì€ ì •ë ¬)
                rotation: typeIdx > 2 ? 0 : Math.random() * Math.PI * 2,
                alive: true,
                falling: false, // ë¹¨ë ¤ë“¤ì–´ê°€ëŠ” ì¤‘ì¸ê°€?
                fallTarget: null,
                fallScale: 1
            });
        }

        function addHole(isHuman) {
            let startR = 25; // ì‹œì‘ í¬ê¸°
            let color = isHuman ? '#6c5ce7' : `hsl(${Math.random()*360}, 70%, 50%)`;
            
            holes.push({
                isHuman: isHuman,
                x: Math.random() * (MAP_SIZE - 200) + 100,
                y: Math.random() * (MAP_SIZE - 200) + 100,
                r: startR,
                color: color,
                name: isHuman ? 'ë‚˜ (Player)' : generateName(),
                score: 0,
                dead: false,
                aiTimer: 0,
                aiTargetX: 0,
                aiTargetY: 0,
                angle: 0 // ì‹œê°ì  íšŒì „ìš©
            });
            return holes.length - 1;
        }

        function loop() {
            if(!gameRunning) return;
            update();
            draw();
            animationFrameId = requestAnimationFrame(loop);
        }

        function update() {
            // ì‚¬ë¬¼ ë¦¬í•„
            if(props.filter(p => p.alive).length < PROP_COUNT * 0.8) {
                for(let i=0; i<10; i++) addProp();
            }

            holes.forEach((h, idx) => {
                if(h.dead) return;

                let dx = 0, dy = 0;
                let speed = 3 + (50 / (h.r + 20)); // í¬ë©´ ëŠë ¤ì§

                if(h.isHuman) {
                    if(inputType === 'joystick') {
                        dx = joystickVector.x;
                        dy = joystickVector.y;
                    } else {
                        let dist = Math.hypot(mouseX, mouseY);
                        if(dist > 10) {
                            let angle = Math.atan2(mouseY, mouseX);
                            dx = Math.cos(angle);
                            dy = Math.sin(angle);
                        }
                    }
                } else {
                    // AI Logic
                    h.aiTimer--;
                    if(h.aiTimer <= 0) {
                        h.aiTimer = Math.random() * 30 + 10;
                        
                        // 1. ìœ„í˜‘ íšŒí”¼ (í° ë¸”ë™í™€)
                        let closestThreat = null;
                        let threatDist = 400;
                        for(let other of holes) {
                            if(other !== h && !other.dead && other.r > h.r) {
                                let d = Math.hypot(h.x - other.x, h.y - other.y);
                                if(d < threatDist) { threatDist = d; closestThreat = other; }
                            }
                        }

                        if(closestThreat) {
                            // ë„ë§
                            let angle = Math.atan2(h.y - closestThreat.y, h.x - closestThreat.x);
                            h.aiTargetX = h.x + Math.cos(angle) * 500;
                            h.aiTargetY = h.y + Math.sin(angle) * 500;
                        } else {
                            // 2. ë¨¹ì´ íƒìƒ‰ (ì‘ì€ ë¸”ë™í™€ or ì‚¬ë¬¼)
                            let bestTarget = null;
                            let minTargetDist = 400;

                            // ì‚¬ë¬¼ ì°¾ê¸°
                            for(let p of props) {
                                if(!p.alive || p.falling) continue;
                                if(h.r > p.r) { // ë¨¹ì„ ìˆ˜ ìˆëŠ” ê²ƒë§Œ
                                    let d = Math.hypot(h.x - p.x, h.y - p.y);
                                    if(d < minTargetDist) { minTargetDist = d; bestTarget = p; }
                                }
                            }
                            
                            if(bestTarget) {
                                h.aiTargetX = bestTarget.x;
                                h.aiTargetY = bestTarget.y;
                            } else {
                                // ëœë¤ ì´ë™ (ë²½ í”¼í•˜ê¸° í¬í•¨)
                                h.aiTargetX = Math.random() * MAP_SIZE;
                                h.aiTargetY = Math.random() * MAP_SIZE;
                            }
                        }
                    }

                    // ëª©í‘œì§€ì  ì´ë™
                    let angle = Math.atan2(h.aiTargetY - h.y, h.aiTargetX - h.x);
                    dx = Math.cos(angle);
                    dy = Math.sin(angle);
                }

                h.x += dx * speed;
                h.y += dy * speed;
                h.x = Math.max(h.r, Math.min(MAP_SIZE - h.r, h.x));
                h.y = Math.max(h.r, Math.min(MAP_SIZE - h.r, h.y));

                // ì‹œê°ì  íšŒì „ (ë¹¨ë ¤ë“¤ì–´ê°€ëŠ” ëŠë‚Œìš©)
                h.angle += 0.05;

                // ì¶©ëŒ ì²˜ë¦¬ (ì‚¬ë¬¼)
                props.forEach(p => {
                    if(!p.alive) return;
                    let dist = Math.hypot(h.x - p.x, h.y - p.y);
                    
                    // ì‚¬ë¬¼ì´ ë¸”ë™í™€ ì¤‘ì‹¬ì— ê°€ê¹Œì›Œì§
                    if(dist < h.r + p.r && h.r > p.r) { 
                        // ë¹¨ë ¤ ë“¤ì–´ê°€ëŠ” ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
                        if(!p.falling) {
                            // ì…êµ¬(ë°˜ì§€ë¦„)ë³´ë‹¤ ì‘ì•„ì•¼ ë¹¨ë ¤ë“¦ (ì¤‘ì‹¬ ë§ê³ )
                            // íŒì •: ë¸”ë™í™€ ë°˜ì§€ë¦„ ì•ˆì— ì‚¬ë¬¼ ì¤‘ì‹¬ì´ ë“¤ì–´ì˜¤ë©´ Falling ì‹œì‘
                            if(dist < h.r - p.r/2) {
                                p.falling = true;
                                p.fallTarget = h;
                            }
                        }
                    }
                });

                // ì¶©ëŒ ì²˜ë¦¬ (ë‹¤ë¥¸ ë¸”ë™í™€)
                holes.forEach((other, oIdx) => {
                    if(h === other || other.dead) return;
                    let dist = Math.hypot(h.x - other.x, h.y - other.y);
                    
                    // ë‚´ê°€ ìƒëŒ€ë¥¼ ë¨¹ìŒ (í¬ê¸°ê°€ ë” ì»¤ì•¼ í•¨ + ì¤‘ì‹¬ì´ ë®ì³ì ¸ì•¼ í•¨)
                    if(dist < h.r && h.r > other.r * 1.1) {
                        other.dead = true;
                        h.r += other.r * 0.2; // ë³´ë„ˆìŠ¤ ì„±ì¥
                        h.score += Math.floor(other.score / 2) + 50;
                        killHole(oIdx);
                    }
                });
            });

            // Falling Props Update
            props.forEach(p => {
                if(p.falling && p.fallTarget) {
                    let t = p.fallTarget;
                    // íƒ€ê²Ÿìœ¼ë¡œ ì´ë™
                    let dx = t.x - p.x;
                    let dy = t.y - p.y;
                    p.x += dx * 0.2; // ë¹¨ë ¤ë“¤ì–´ê°€ëŠ” ì†ë„
                    p.y += dy * 0.2;
                    p.fallScale -= 0.1; // ì‘ì•„ì§

                    if(p.fallScale <= 0 || t.dead) {
                        p.alive = false;
                        if(!t.dead) {
                            t.score += p.score;
                            t.r += p.score * 0.1; // ì„±ì¥ (ì¡°ê¸ˆì”©)
                        }
                    }
                }
            });

            // ì ìˆ˜íŒ
            if(playerIndex !== -1 && holes[playerIndex]) {
                scoreBox.innerText = `ì ìˆ˜: ${holes[playerIndex].score}`;
            }
            updateLeaderboard();
        }

        function killHole(idx) {
            let h = holes[idx];
            if(h.isHuman) {
                gameOver(holes.find(killer => !killer.dead && killer.r > h.r)?.name || "ê±°ëŒ€ ë¸”ë™í™€");
            } else {
                showKillLog(`${h.name} ì†Œë©¸!`);
                setTimeout(() => { if(gameRunning) { holes.splice(idx, 1); addHole(false); } }, 3000);
            }
        }

        function draw() {
            let p = holes[playerIndex];
            
            ctx.fillStyle = '#f0f2f5'; // ë°°ê²½ìƒ‰
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            let zoom = 1;
            let camX = 0, camY = 0;

            if (p && !p.dead) {
                zoom = Math.max(0.4, 40 / (p.r + 20));
                camX = canvas.width/2 - p.x * zoom;
                camY = canvas.height/2 - p.y * zoom;
            } else {
                camX = canvas.width/2 - MAP_SIZE/2 * zoom;
                camY = canvas.height/2 - MAP_SIZE/2 * zoom;
            }

            ctx.save();
            ctx.translate(camX, camY);
            ctx.scale(zoom, zoom);

            // 1. ë§µ ê·¸ë¦¬ë“œ (ë„ë¡œ ëŠë‚Œ)
            ctx.lineWidth = 150; // ë¸”ë¡ ê°„ê²©
            ctx.strokeStyle = '#dcdde1'; // ë„ë¡œ ìƒ‰
            ctx.beginPath();
            // ê°€ë¡œ ë„ë¡œ
            for(let y=0; y<=MAP_SIZE; y+=400) {
                ctx.moveTo(0, y); ctx.lineTo(MAP_SIZE, y);
            }
            // ì„¸ë¡œ ë„ë¡œ
            for(let x=0; x<=MAP_SIZE; x+=400) {
                ctx.moveTo(x, 0); ctx.lineTo(x, MAP_SIZE);
            }
            ctx.stroke();

            // ë§µ ê²½ê³„
            ctx.strokeStyle = '#ff7675'; ctx.lineWidth = 20;
            ctx.strokeRect(0, 0, MAP_SIZE, MAP_SIZE);


            // 2. ì‚¬ë¬¼ ê·¸ë¦¬ê¸° (Fallingì´ ì•„ë‹Œ ê²ƒ ë¨¼ì € -> Fallingì¸ ê²ƒ ë‚˜ì¤‘ì—? ì•„ë‹ˆ, ë¸”ë™í™€ì´ ìœ„ì— ë®ì–´ì•¼ í•¨)
            // ìˆœì„œ: ë°”ë‹¥ -> Falling ì‚¬ë¬¼ -> ë¸”ë™í™€ -> ì‚´ì•„ìˆëŠ” ì‚¬ë¬¼ (ì•ˆë¨¹íŒê±°) -> í…ìŠ¤íŠ¸
            // 2.5D íš¨ê³¼ë¥¼ ìœ„í•´ Yì¶• ì •ë ¬ (ë©€ë¦¬ ìˆëŠ”ê²Œ ë’¤ì—, ê°€ê¹Œìš´ê²Œ ì•ì—)
            
            // í†µí•© ë Œë”ë§ ë¦¬ìŠ¤íŠ¸ ìƒì„±
            let renderList = [];
            
            // êµ¬ë© ì¶”ê°€
            holes.forEach(h => {
                if(!h.dead) renderList.push({type: 'hole', obj: h, y: h.y});
            });

            // ì‚¬ë¬¼ ì¶”ê°€
            props.forEach(p => {
                if(p.alive) {
                    // 2.5D ì •ë ¬ì„ ìœ„í•´ yì¢Œí‘œ ê¸°ì¤€
                    // ë¹¨ë ¤ë“¤ì–´ê°€ëŠ” ì¤‘ì´ë©´ êµ¬ë©ë³´ë‹¤ ì•„ë˜(ë’¤)ì— ê·¸ë ¤ì ¸ì•¼ í•¨ -> êµ¬ë©ë³´ë‹¤ ë¨¼ì € ê·¸ë¦°ë‹¤?
                    // ì•„ë‹ˆ, êµ¬ë©ì´ ì œì¼ ì•„ë˜(ë•…ë°”ë‹¥)ê³ , ì‚¬ë¬¼ì´ ê·¸ ìœ„ì„.
                    // ë¹¨ë ¤ë“¤ì–´ê°€ë©´: ì‚¬ë¬¼ì´ êµ¬ë© ì¤‘ì‹¬(y)ë³´ë‹¤ ë’¤ë©´ êµ¬ë© ë’¤, ì•ì´ë©´ êµ¬ë© ì•... ë³µì¡í•¨.
                    // ê°„ë‹¨íˆ: êµ¬ë©ì€ 'ë°”ë‹¥' ë ˆì´ì–´. ì‚¬ë¬¼ì€ 'ì§€ìƒ' ë ˆì´ì–´.
                    // ë‹¨, ë¹¨ë ¤ë“¤ì–´ê°ˆ ë• ì‚¬ë¬¼ì´ ì‘ì•„ì§€ë©´ì„œ êµ¬ë© ì¤‘ì‹¬ìœ¼ë¡œ.
                    // êµ¬ë© ê·¸ë¦¬ê¸° -> ì‚¬ë¬¼ ê·¸ë¦¬ê¸° ìˆœì„œë©´ ì‚¬ë¬¼ì´ êµ¬ë© ìœ„ì— ëœ¸.
                    // êµ¬ë©ì´ ì‚¬ë¬¼ì„ ë®ìœ¼ë ¤ë©´? êµ¬ë©ì€ 'êµ¬ë©'ì„. ë¹„ì–´ìˆìŒ.
                    // ìº”ë²„ìŠ¤ì—ì„œ êµ¬ë© íš¨ê³¼ë¥¼ ë‚´ë ¤ë©´:
                    // 1. ë°°ê²½ ê·¸ë¦¼
                    // 2. êµ¬ë©(ê²€ì€ ì›) ê·¸ë¦¼
                    // 3. ì‚¬ë¬¼ ê·¸ë¦¼ (ë‹¨, êµ¬ë© ì˜ì—­ì— ê±¸ì¹˜ë©´ ì˜ë¦¬ê±°ë‚˜(clip), ì‘ì•„ì ¸ì•¼ í•¨)
                    // ì‰¬ìš´ ë°©ë²•: ë¹¨ë ¤ë“¤ì–´ê°€ëŠ” ì‚¬ë¬¼ì€ êµ¬ë©ë³´ë‹¤ ë¨¼ì € ê·¸ë¦¬ê³ (êµ¬ë© ë°‘ìœ¼ë¡œ ë“¤ì–´ê°€ëŠ” ëŠë‚Œ), ì•ˆ ë¹¨ë ¤ê°€ëŠ”ê±´ ë‚˜ì¤‘ì—.
                    
                    if(p.falling) renderList.push({type: 'prop_fall', obj: p, y: p.y});
                    else renderList.push({type: 'prop', obj: p, y: p.y});
                }
            });

            // ë ˆì´ì–´ë³„ ê·¸ë¦¬ê¸° í•¨ìˆ˜ ë¶„ë¦¬
            
            // Layer 1: Falling Props (êµ¬ë© ì†ìœ¼ë¡œ ì‚¬ë¼ì§€ëŠ”)
            props.forEach(prop => {
                if(prop.alive && prop.falling) drawProp25D(ctx, prop);
            });

            // Layer 2: Holes (ì§€ë©´ì˜ êµ¬ë©)
            holes.forEach(h => {
                if(!h.dead) drawHole(ctx, h);
            });

            // Layer 3: Normal Props (ì§€ìƒì— ìˆëŠ”) - Yì¶• ì •ë ¬ í•„ìš” (ì• ê±´ë¬¼ì´ ë’· ê±´ë¬¼ ê°€ë¦¼)
            let groundProps = props.filter(p => p.alive && !p.falling);
            groundProps.sort((a,b) => a.y - b.y);
            
            groundProps.forEach(prop => {
                // í™”ë©´ ë°– Culling
                if(Math.abs(prop.x - (player?player.x:0)) > (canvas.width/zoom + 200)) return;
                drawProp25D(ctx, prop);
            });

            // Layer 4: í…ìŠ¤íŠ¸ (ì´ë¦„)
            holes.forEach(h => {
                if(!h.dead) {
                    ctx.fillStyle = 'white';
                    ctx.strokeStyle = 'black';
                    ctx.lineWidth = 3;
                    ctx.font = `bold ${Math.max(12, h.r*0.4)}px Jua`;
                    ctx.textAlign = 'center';
                    ctx.strokeText(h.name, h.x, h.y - h.r - 10);
                    ctx.fillText(h.name, h.x, h.y - h.r - 10);
                }
            });

            ctx.restore();
        }

        function drawHole(ctx, h) {
            // êµ¬ë© ë‚´ë¶€ (ê²€ì •)
            ctx.beginPath();
            ctx.arc(h.x, h.y, h.r, 0, Math.PI*2);
            ctx.fillStyle = 'black';
            ctx.fill();

            // íšŒì „í•˜ëŠ” ë¦¼ (Accretion Disk ëŠë‚Œ)
            ctx.save();
            ctx.translate(h.x, h.y);
            ctx.rotate(h.angle);
            
            let grad = ctx.createRadialGradient(0, 0, h.r * 0.8, 0, 0, h.r + 5);
            grad.addColorStop(0, 'black');
            grad.addColorStop(0.9, h.color);
            grad.addColorStop(1, 'transparent');
            
            ctx.fillStyle = grad;
            // í†±ë‹ˆë°”í€´ ëª¨ì–‘ìœ¼ë¡œ ê·¸ë¦¬ê¸°
            ctx.beginPath();
            for(let i=0; i<10; i++) {
                ctx.arc(0, 0, h.r + (i%2==0 ? 5 : 0), i*Math.PI/5, (i+1)*Math.PI/5);
            }
            ctx.fill();

            ctx.restore();
        }

        function drawProp25D(ctx, p) {
            let scale = p.falling ? p.fallScale : 1;
            let w = p.r * 2 * scale;
            let h = p.r * 2 * scale; // ë°”ë‹¥ ë©´ì 
            let d = p.h * scale;     // ë†’ì´ (Height)

            ctx.save();
            ctx.translate(p.x, p.y);
            
            // ë¹¨ë ¤ë“¤ì–´ê°ˆ ë•Œ íšŒì „í•˜ë©° ì‘ì•„ì§
            if(p.falling) ctx.rotate(p.fallScale * 10); 
            else ctx.rotate(p.rotation);

            // 2.5D ë“œë¡œì‰ (Top-Down Extrusion)
            // ê·¸ë¦¼ì
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.beginPath();
            ctx.ellipse(5*scale, 5*scale, w/2, h/2, 0, 0, Math.PI*2);
            ctx.fill();

            // ì˜†ë©´ (ë†’ì´) - ì•½ê°„ ì–´ë‘ìš´ ìƒ‰
            ctx.fillStyle = p.side;
            // ì›í˜• ì‚¬ë¬¼ vs ì‚¬ê°í˜• ì‚¬ë¬¼
            if (p.id === 0 || p.id === 1) { // ê¼¬ê¹”, ì‚¬ëŒ, ë‚˜ë¬´ (ì›í˜•)
                // ì›ê¸°ë‘¥ íš¨ê³¼ëŠ” ë³µì¡í•˜ë¯€ë¡œ ê°„ë‹¨íˆ ì› ë‘ê°œ ê²¹ì¹¨
                ctx.beginPath(); ctx.arc(0, -d, w/2, 0, Math.PI*2); ctx.fill(); // ìœ—ë©´ ë¯¸ë¦¬ ì‚´ì§
                ctx.beginPath(); 
                ctx.moveTo(-w/2, 0); ctx.lineTo(-w/2, -d); 
                ctx.arc(0, -d, w/2, Math.PI, 0); 
                ctx.lineTo(w/2, 0); ctx.arc(0, 0, w/2, 0, Math.PI); 
                ctx.fill();
            } else { // ì°¨, ê±´ë¬¼ (ì‚¬ê°í˜•)
                // í•˜ë‹¨(ë°”ë‹¥)ì—ì„œ ìƒë‹¨(ì§€ë¶•)ìœ¼ë¡œ ì—°ê²°í•˜ëŠ” ì˜†ë©´
                ctx.fillRect(-w/2, -h/2, w, h); // ë°”ë‹¥ (ì‚¬ì‹¤ ì•ˆë³´ì„)
                // ì •ë©´(ë‚¨ìª½) ë©´
                ctx.fillRect(-w/2, h/2 - d, w, d); 
                // ì´ ë°©ì‹ë³´ë‹¨.. ê·¸ëƒ¥ dë§Œí¼ yë¥¼ ëº€ ìœ„ì¹˜ì— ìœ—ë©´ì„ ê·¸ë¦¬ê³ , 
                // yì¶• ì˜¤í”„ì…‹ì„ ì¤˜ì„œ ì…ì²´ê°ì„ ì¤Œ.
                
                // ì˜†ë©´ (Side Layer) - ë‚¨ìª½ë©´ ëŠë‚Œ
                ctx.fillStyle = p.side;
                ctx.fillRect(-w/2, -h/2, w, h); // ë°”ë‹¥ ë² ì´ìŠ¤
                
                // ìœ—ë©´ (Top Layer) - yì¶•ìœ¼ë¡œ -d ë§Œí¼ ì´ë™
                ctx.fillStyle = p.color;
                ctx.translate(0, -d);
                ctx.fillRect(-w/2, -h/2, w, h);
                
                // ìœ—ë©´ ë°ì½” (ì°½ë¬¸, ì§€ë¶• ë“±)
                if(p.id === 2) { // ì°¨ ìœ ë¦¬
                    ctx.fillStyle = '#bdc3c7';
                    ctx.fillRect(-w/2+2*scale, -h/2+4*scale, w-4*scale, h*0.3);
                } else if(p.id === 3) { // ì§‘ ì§€ë¶•
                    ctx.beginPath();
                    ctx.moveTo(-w/2, -h/2); ctx.lineTo(0, -h/2 - 5*scale); ctx.lineTo(w/2, -h/2);
                    ctx.fillStyle = '#c0392b'; ctx.fill();
                } else if(p.id === 4) { // ë¹Œë”© ì˜¥ìƒ H
                    ctx.fillStyle = '#ecf0f1';
                    ctx.font = `bold ${12*scale}px sans-serif`;
                    ctx.textAlign = 'center'; ctx.textBaseline='middle';
                    ctx.fillText('H', 0, 0);
                }
            }

            // ì›í˜• ìœ—ë©´ (ë‚˜ë¬´, ì‚¬ëŒ ë“±)
            if (p.id === 0 || p.id === 1) {
                ctx.translate(0, -d);
                ctx.fillStyle = p.color;
                ctx.beginPath(); ctx.arc(0, 0, w/2, 0, Math.PI*2); ctx.fill();
            }

            ctx.restore();
        }

        function showKillLog(msg) {
            killLog.innerText = msg; killLog.style.opacity = 1;
            setTimeout(() => { killLog.style.opacity = 0; }, 2000);
        }

        function updateLeaderboard() {
            let list = [...holes].filter(h => !h.dead).sort((a,b) => b.score - a.score);
            let html = '';
            for(let i=0; i<Math.min(5, list.length); i++) {
                let h = list[i];
                let name = h.isHuman ? `<span style="color:#6c5ce7">${h.name}</span>` : h.name;
                html += `<li>${i+1}. ${name} <small>(${h.score})</small></li>`;
            }
            rankList.innerHTML = html;
        }

        function gameOver(killer) {
            gameRunning = false;
            cancelAnimationFrame(animationFrameId);
            uiLayer.style.display = 'flex';
            document.getElementById('ui-title').innerText = "ğŸ’€ ê²Œì„ ì˜¤ë²„";
            document.getElementById('ui-desc').innerHTML = `
                <b>${killer}</b>ì—ê²Œ í¡ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                ìµœì¢… ì ìˆ˜: <span style="color:#6c5ce7; font-weight:bold;">${holes[playerIndex].score}</span>
            `;
            startBtn.innerText = "ë‹¤ì‹œ ë„ì „í•˜ê¸° â†º";
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                const toast = document.getElementById("toast");
                toast.className = "show";
                setTimeout(() => toast.className = toast.className.replace("show", ""), 3000);
            });
        }

        init();
    </script>
</body>
</html>
