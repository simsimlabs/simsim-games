<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì§€ë ì´ í‚¤ìš°ê¸° - ì‹¬ì‹¬í’€ì´ ê²Œì„ ì—°êµ¬ì†Œ</title>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2261846676525942" crossorigin="anonymous"></script>
    
    <link rel="canonical" href="https://simsimlabs.com/simsim-games/game3.html">

    <meta name="description" content="ì§€ë ì´ í‚¤ìš°ê¸°(Worm.io) ë¬´ë£Œ ì›¹ê²Œì„. ë¹›ì„ ë¨¹ê³  ê¸¸ì–´ì ¸ì„œ ì ì„ í¬ìœ„í•˜ì„¸ìš”. ì„¤ì¹˜ ì—†ëŠ” ì‹¤ì‹œê°„ ì„œë°”ì´ë²Œ ì•¡ì…˜ ê²Œì„.">
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="ğŸ ì§€ë ì´ í‚¤ìš°ê¸° - ì‹¬ì‹¬í’€ì´ ê²Œì„ ì—°êµ¬ì†Œ">
    <meta property="og:description" content="ë¹›ì„ ë¨¹ê³  ê±°ëŒ€í•´ì§€ì„¸ìš”! ë¶€ìŠ¤íŠ¸ë¥¼ ì¨ì„œ ì ì˜ ì•ì„ ê°€ë¡œë§‰ê³  ìŠ¹ë¦¬í•˜ì„¸ìš”.">
    <meta property="og:image" content="https://simsimlabs.com/simsim-games/thumbnail.png">
    <meta property="og:url" content="https://simsimlabs.com/simsim-games/game3.html">

    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* 1. ê¸°ë³¸ ë ˆì´ì•„ì›ƒ */
        body { 
            margin: 0; padding: 0; 
            background-color: #f0f2f5; 
            font-family: 'Noto Sans KR', sans-serif;
            color: #333;
            overflow-x: hidden; 
        }

        header {
            background: #2d3436; color: white; padding: 15px 20px; text-align: center;
        }

        .header-top {
            display: flex; justify-content: space-between; max-width: 1200px; margin: 0 auto 10px; font-size: 0.9rem;
        }
        .header-top a { color: #dfe6e9; text-decoration: none; }

        h1 { margin: 0; font-family: 'Jua', sans-serif; font-size: 1.8rem; }

        /* 2. ê´‘ê³  ì˜ì—­ */
        .ad-banner {
            width: 100%; max-width: 1200px; margin: 20px auto;
            text-align: center; background: #fff; padding: 10px 0;
            border-radius: 8px; overflow: hidden;
        }

        /* 3. ê²Œì„ ì»¨í…Œì´ë„ˆ (ë°˜ì‘í˜•) */
        #game-container-box {
            position: relative;
            width: 100%; 
            max-width: 1280px; 
            height: 720px;     
            margin: 0 auto;
            background-color: #1e272e; border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }

        canvas { display: block; width: 100%; height: 100%; cursor: crosshair; }

        /* 4. UI ë ˆì´ì–´ */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; color: white; text-align: center;
        }

        #ui-layer h2 { font-family: 'Jua', sans-serif; font-size: 3.5rem; color: #fab1a0; margin-bottom: 10px; text-shadow: 3px 3px 0 #fff; }
        #ui-layer p { font-size: 1.2rem; color: #dfe6e9; margin-bottom: 30px; line-height: 1.6; }
        
        #start-btn {
            background: #e17055; color: white; border: none; padding: 15px 60px;
            font-size: 1.8rem; font-family: 'Jua', sans-serif; border-radius: 50px;
            cursor: pointer; box-shadow: 0 5px 0 #d63031; transition: transform 0.1s;
        }
        #start-btn:active { transform: translateY(4px); box-shadow: none; }
        #start-btn:hover { background: #fab1a0; }

        /* 5. ì¸ê²Œì„ HUD */
        #leaderboard {
            position: absolute; top: 15px; right: 15px;
            background: rgba(0,0,0,0.5); color: white; padding: 15px;
            border-radius: 8px; font-family: 'Jua', sans-serif; font-size: 1rem;
            min-width: 160px; pointer-events: none; z-index: 50;
        }
        #rank-list { list-style: none; padding: 0; margin: 0; }
        #rank-list li { margin-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.2); }

        #score-box {
            position: absolute; top: 15px; left: 15px;
            color: white; font-family: 'Jua', sans-serif; font-size: 1.5rem;
            text-shadow: 2px 2px 0 #000; pointer-events: none; z-index: 50;
        }

        #kill-log {
            position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%);
            background: rgba(214, 48, 49, 0.9); color: white;
            padding: 10px 30px; border-radius: 30px; font-weight: bold;
            opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 50;
            white-space: nowrap; font-size: 1.1rem;
        }

        /* 6. ëª¨ë°”ì¼ ì»¨íŠ¸ë¡¤ */
        #joystick-zone {
            position: absolute; bottom: 30px; left: 30px; width: 140px; height: 140px;
            z-index: 90; display: none; 
        }
        #joystick-bg {
            width: 100%; height: 100%; background: rgba(255, 255, 255, 0.15);
            border-radius: 50%; position: relative; border: 2px solid rgba(255,255,255,0.3);
        }
        #joystick-stick {
            width: 60px; height: 60px; background: rgba(255, 255, 255, 0.8);
            border-radius: 50%; position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        #boost-btn-mobile {
            position: absolute; bottom: 40px; right: 40px;
            width: 80px; height: 80px; border-radius: 50%;
            background: rgba(255, 100, 100, 0.6); border: 3px solid rgba(255,255,255,0.5);
            display: none; justify-content: center; align-items: center;
            font-size: 2rem; color: white; z-index: 90;
            touch-action: none;
        }
        #boost-btn-mobile:active { background: rgba(255, 50, 50, 0.9); transform: scale(0.95); }

        /* 7. ì½˜í…ì¸  ì„¤ëª…ê¸€ */
        .content-article {
            max-width: 1200px; margin: 40px auto; padding: 40px;
            background: #fff; border-radius: 12px; line-height: 1.8;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .content-article h2 { color: #e17055; border-bottom: 2px solid #f1f2f6; padding-bottom: 10px; margin-top: 30px; }
        .content-article h3 { color: #74b9ff; margin-top: 25px; }
        .content-article ul { background: #f8f9fa; padding: 20px 40px; border-radius: 8px; }

        /* 8. ê³µìœ  ë²„íŠ¼ */
        .share-bar { text-align: center; margin: 30px 0; }
        .share-btn {
            background: #333; color: white; border: none; padding: 12px 25px;
            border-radius: 30px; cursor: pointer; font-size: 1rem; margin: 0 5px;
            transition: 0.2s;
        }
        .share-btn:hover { transform: translateY(-2px); }
        .share-btn.copy { background: #6c5ce7; }
        
        #toast {
            visibility: hidden; min-width: 250px; margin-left: -125px;
            background-color: #333; color: #fff; text-align: center;
            border-radius: 2px; padding: 16px; position: fixed; z-index: 1000;
            left: 50%; bottom: 30px; font-size: 17px; opacity: 0; transition: 0.5s;
        }
        #toast.show { visibility: visible; opacity: 1; bottom: 50px; }

        footer { text-align: center; padding: 30px; color: #b2bec3; font-size: 0.9rem; }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 800px) {
            #game-container-box {
                width: 100%;
                height: 85vh; 
                border-radius: 0;
            }
            #ui-layer h2 { font-size: 2.2rem; }
            .content-article { margin: 20px 10px; padding: 20px; }
            h1 { font-size: 1.4rem; }
        }
    </style>
</head>
<body>

    <header>
        <div class="header-top">
            <a href="en/game3.html">ğŸ‡ºğŸ‡¸ English</a>
            <a href="index.html">ğŸ  ê²Œì„ ëª©ë¡ìœ¼ë¡œ</a>
        </div>
        <h1>ğŸ ì§€ë ì´ í‚¤ìš°ê¸°</h1>
    </header>

    <div class="ad-banner">
        <span style="font-size:10px; color:#ccc;">Sponsored</span>
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-2261846676525942"
             data-ad-slot="4380369066"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <div id="game-container-box">
        <canvas id="gameCanvas"></canvas>

        <div id="score-box">ê¸¸ì´: 10</div>

        <div id="leaderboard">
            <h3>ğŸ† ë­í‚¹ Top 5</h3>
            <ul id="rank-list"><li>Loading...</li></ul>
        </div>

        <div id="kill-log"></div>

        <div id="joystick-zone">
            <div id="joystick-bg">
                <div id="joystick-stick"></div>
            </div>
        </div>
        <div id="boost-btn-mobile">âš¡</div>

        <div id="ui-layer">
            <h2 id="ui-title">Worm.io</h2>
            <p id="ui-desc">
                ë§ˆìš°ìŠ¤ë¥¼ ì›€ì§ì—¬ ì´ë™í•˜ì„¸ìš”.<br>
                í´ë¦­í•˜ë©´ ë¹¨ë¼ì§‘ë‹ˆë‹¤!<br>
                ë¨¸ë¦¬ê°€ ë‹¤ë¥¸ ì§€ë ì´ì— ë‹¿ìœ¼ë©´ ì£½ìŠµë‹ˆë‹¤.
            </p>
            <button id="start-btn">ê²Œì„ ì‹œì‘ â–¶</button>
        </div>
    </div>

    <div class="ad-banner">
        <span style="font-size:10px; color:#ccc;">Sponsored</span>
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-2261846676525942"
             data-ad-slot="4380369066"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <div class="share-bar">
        <button class="share-btn copy" onclick="copyLink()"><i class="fa-solid fa-link"></i> ì¹œêµ¬ì™€ ë§í¬ ê³µìœ </button>
    </div>
    <div id="toast">ğŸ“‹ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>

    <article class="content-article">
        <h2>ğŸ® ì§€ë ì´ í‚¤ìš°ê¸° (Worm.io) ê°€ì´ë“œ</h2>
        <p>
            ì§€ë ì´ í‚¤ìš°ê¸°ëŠ” ì „ ì„¸ê³„ì ìœ¼ë¡œ ì¸ê¸° ìˆëŠ” IO ì¥ë¥´ì˜ ì„œë°”ì´ë²Œ ê²Œì„ì…ë‹ˆë‹¤.
            ì‘ì€ ì§€ë ì´ë¡œ ì‹œì‘í•´ ë§µì— í©ì–´ì§„ ë¹›ì„ ë¨¹ê³  ê±°ëŒ€í•˜ê²Œ ì„±ì¥í•˜ì„¸ìš”.
            ë‹¤ë¥¸ í”Œë ˆì´ì–´ì˜ ëª¸í†µì— ë¨¸ë¦¬ë¥¼ ë¶€ë”ªíˆê²Œ ë§Œë“¤ì–´ ì“°ëŸ¬ëœ¨ë¦¬ê³ , ê·¸ë“¤ì´ ë–¨ì–´ëœ¨ë¦° ë¹›ì„ í¡ìˆ˜í•˜ì—¬ ë¹ ë¥´ê²Œ í´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>

        <h3>ğŸ•¹ï¸ ì¡°ì‘ ë°©ë²•</h3>
        <ul>
            <li><strong>PC:</strong> ë§ˆìš°ìŠ¤ ì»¤ì„œ ë°©í–¥ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤. ë§ˆìš°ìŠ¤ í´ë¦­ ì‹œ ë¶€ìŠ¤íŠ¸(ê°€ì†)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
            <li><strong>ëª¨ë°”ì¼:</strong> ì¢Œì¸¡ ì¡°ì´ìŠ¤í‹±ìœ¼ë¡œ ì´ë™í•˜ê³ , ìš°ì¸¡ ë²ˆê°œ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê°€ì†í•©ë‹ˆë‹¤.</li>
            <li><strong>ê·œì¹™:</strong> ë‹¤ë¥¸ ì§€ë ì´ì˜ ëª¸ì— ë¨¸ë¦¬ê°€ ë‹¿ìœ¼ë©´ ì£½ìŠµë‹ˆë‹¤. ë‚´ ëª¸ì— ë‹¿ëŠ” ê±´ ê´œì°®ìŠµë‹ˆë‹¤.</li>
        </ul>

        <h3>ğŸ† ê³ ë“ì  ë¹„ë²•</h3>
        <p>
            1. <strong>ê°€ì† í™œìš©:</strong> ë¶€ìŠ¤íŠ¸ë¥¼ ì“°ë©´ ë‚´ ëª¸ì˜ ì¼ë¶€ë¥¼ ë–¨ì–´ëœ¨ë¦¬ë©° ì‘ì•„ì§€ì§€ë§Œ, ìˆœì‹ê°„ì— ì ì˜ ì•ì„ ê°€ë¡œë§‰ì•„ ì œì••í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><br>
            2. <strong>í¬ìœ„ ì‘ì „:</strong> ëª¸ì´ ì¶©ë¶„íˆ ê¸¸ì–´ì¡Œë‹¤ë©´ ì‘ì€ ì ì„ ë‘¥ê¸€ê²Œ ê°ì‹¸ì„œ ê°€ë‘ì„¸ìš”. ê°‡íŒ ì ì€ ê²°êµ­ ë‚´ ëª¸ì— ë¶€ë”ªí˜€ ì£½ê²Œ ë©ë‹ˆë‹¤.<br><br>
            3. <strong>ëˆˆì¹˜ ì‹¸ì›€:</strong> ê±°ëŒ€í•œ ì§€ë ì´ê°€ ì£½ìœ¼ë©´ ì—„ì²­ë‚œ ì–‘ì˜ ë¹›ì´ ìŸì•„ì§‘ë‹ˆë‹¤. ì´ë•Œ ëª°ë ¤ë“œëŠ” ë‹¤ë¥¸ ì§€ë ì´ë“¤ì„ ì¡°ì‹¬í•˜ë©° ëˆˆì¹˜ê» ë¹›ì„ ì±™ê¸°ì„¸ìš”.
        </p>
    </article>

    <footer>
        <p>Â© 2024 SimSim Game Labs. All rights reserved.</p>
        <a href="https://simsimlabs.com/privacy.html" style="color:#b2bec3; text-decoration:none;">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
    </footer>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('game-container-box');
        
        const uiLayer = document.getElementById('ui-layer');
        const uiTitle = document.getElementById('ui-title');
        const uiDesc = document.getElementById('ui-desc');
        const startBtn = document.getElementById('start-btn');
        const scoreBox = document.getElementById('score-box');
        
        const rankList = document.getElementById('rank-list');
        const killLog = document.getElementById('kill-log');
        
        const joystickZone = document.getElementById('joystick-zone');
        const joystickStick = document.getElementById('joystick-stick');
        const boostBtnMobile = document.getElementById('boost-btn-mobile');

        // ê²Œì„ ì„¤ì •
        const MAP_SIZE = 3000;
        const FOOD_COUNT = 800;
        const BOT_COUNT = 25;
        
        let snakes = [];
        let foods = [];
        let gameRunning = false;
        let animationFrameId;

        // í”Œë ˆì´ì–´ ë³€ìˆ˜
        let playerIndex = -1;
        let mouseX = 0, mouseY = 0;
        let inputType = 'mouse';
        let isBoosting = false;
        let joystickAngle = 0;
        let joystickActive = false;

        // ì´ë¦„ ë°ì´í„°
        const adjectives = ["ê¿ˆí‹€ëŒ€ëŠ”", "ë¹›ë‚˜ëŠ”", "í™”ë‚œ", "ë°°ê³ í”ˆ", "ë¹ ë¥¸", "ê±°ëŒ€í•œ", "ê·€ì—¬ìš´", "ë¬´ì„œìš´", "íˆ¬ëª…í•œ", "í™©ê¸ˆ"];
        const nouns = ["ì§€ë ì´", "ì•„ë‚˜ì½˜ë‹¤", "ì½”ë¸Œë¼", "ì¥ì–´", "êµ­ìˆ˜", "ì†Œì„¸ì§€", "ê°€ë˜ë–¡", "ìš°ë™", "ë¼ë©´", "ë°”ì´ëŸ¬ìŠ¤"];
        function generateName() { return adjectives[Math.floor(Math.random()*adjectives.length)] + " " + nouns[Math.floor(Math.random()*nouns.length)]; }

        // ì´ˆê¸°í™”
        function init() {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // ëª¨ë°”ì¼ ê°ì§€
            if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
                joystickZone.style.display = 'block';
                boostBtnMobile.style.display = 'flex';
                inputType = 'joystick';
                initJoystick();
            }

            // PC ë§ˆìš°ìŠ¤
            container.addEventListener('mousemove', e => {
                if(inputType !== 'joystick') {
                    const rect = canvas.getBoundingClientRect();
                    const scaleX = canvas.width / rect.width;
                    const scaleY = canvas.height / rect.height;
                    // í™”ë©´ ì¤‘ì•™ ê¸°ì¤€ ìƒëŒ€ ì¢Œí‘œ
                    mouseX = (e.clientX - rect.left) * scaleX - canvas.width / 2;
                    mouseY = (e.clientY - rect.top) * scaleY - canvas.height / 2;
                }
            });

            container.addEventListener('mousedown', () => { if(inputType !== 'joystick') isBoosting = true; });
            container.addEventListener('mouseup', () => { if(inputType !== 'joystick') isBoosting = false; });
            
            // ëª¨ë°”ì¼ ë¶€ìŠ¤íŠ¸
            boostBtnMobile.addEventListener('touchstart', (e) => { e.preventDefault(); isBoosting = true; });
            boostBtnMobile.addEventListener('touchend', (e) => { e.preventDefault(); isBoosting = false; });

            startBtn.addEventListener('click', startGame);
        }

        function resizeCanvas() {
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }

        function initJoystick() {
            let startX, startY;
            const maxDist = 35;
            
            joystickZone.addEventListener('touchstart', e => {
                e.preventDefault();
                joystickActive = true;
                let t = e.touches[0];
                startX = t.clientX;
                startY = t.clientY;
                joystickStick.style.transition = 'none';
            });

            joystickZone.addEventListener('touchmove', e => {
                if(!joystickActive) return;
                e.preventDefault();
                let t = e.touches[0];
                let dx = t.clientX - startX;
                let dy = t.clientY - startY;
                let dist = Math.min(maxDist, Math.hypot(dx, dy));
                joystickAngle = Math.atan2(dy, dx);
                
                joystickStick.style.transform = `translate(-50%, -50%) translate(${Math.cos(joystickAngle)*dist}px, ${Math.sin(joystickAngle)*dist}px)`;
            });

            joystickZone.addEventListener('touchend', e => {
                e.preventDefault();
                joystickActive = false;
                joystickStick.style.transform = `translate(-50%, -50%)`;
            });
        }

        function startGame() {
            if(animationFrameId) cancelAnimationFrame(animationFrameId);
            uiLayer.style.display = 'none';
            gameRunning = true;
            
            snakes = [];
            foods = [];
            
            // ìŒì‹ ìƒì„±
            for(let i=0; i<FOOD_COUNT; i++) addFood();
            
            // í”Œë ˆì´ì–´ ìƒì„±
            playerIndex = addSnake(true);
            
            // ë´‡ ìƒì„±
            for(let i=0; i<BOT_COUNT; i++) addSnake(false);

            loop();
        }

        function addFood(x, y, val=1) {
            foods.push({
                x: x || Math.random() * MAP_SIZE,
                y: y || Math.random() * MAP_SIZE,
                r: val > 1 ? 6 : 3, // í° ë¨¹ì´ëŠ” ë” í¼
                val: val,
                color: `hsl(${Math.random()*360}, 100%, 70%)`
            });
        }

        function addSnake(isHuman) {
            let x = Math.random() * (MAP_SIZE - 200) + 100;
            let y = Math.random() * (MAP_SIZE - 200) + 100;
            
            snakes.push({
                isHuman: isHuman,
                x: x, y: y,
                angle: Math.random() * Math.PI * 2,
                targetAngle: 0,
                speed: 3,
                radius: 10,
                length: 10, // ì´ˆê¸° ê¸¸ì´
                body: [], // ëª¸í†µ ì¢Œí‘œ ë°°ì—´
                color: isHuman ? '#e17055' : `hsl(${Math.random()*360}, 70%, 50%)`,
                name: isHuman ? 'ë‚˜' : generateName(),
                dead: false,
                score: 0,
                // AIìš© ë³€ìˆ˜
                changeDirTimer: 0
            });
            
            // ì´ˆê¸° ëª¸í†µ ìƒì„±
            let s = snakes[snakes.length-1];
            for(let i=0; i<20; i++) s.body.push({x: x, y: y});
            
            return snakes.length - 1;
        }

        function loop() {
            if(!gameRunning) return;
            
            update();
            draw();
            animationFrameId = requestAnimationFrame(loop);
        }

        function update() {
            // ìŒì‹ ë¦¬í•„
            if(foods.length < FOOD_COUNT) addFood();

            // ì§€ë ì´ ì—…ë°ì´íŠ¸
            snakes.forEach((s, idx) => {
                if(s.dead) return;

                // 1. íšŒì „ ë¡œì§
                if (s.isHuman) {
                    if (inputType === 'joystick' && joystickActive) {
                        s.targetAngle = joystickAngle;
                    } else if (inputType === 'mouse') {
                        s.targetAngle = Math.atan2(mouseY, mouseX);
                    }
                } else {
                    // AI ë¡œì§
                    updateBotAI(s);
                }

                // ë¶€ë“œëŸ¬ìš´ íšŒì „
                let diff = s.targetAngle - s.angle;
                while (diff <= -Math.PI) diff += Math.PI * 2;
                while (diff > Math.PI) diff -= Math.PI * 2;
                s.angle += diff * 0.1;

                // 2. ì´ë™ & ë¶€ìŠ¤íŠ¸
                let currentSpeed = s.speed;
                let boosting = (s.isHuman && isBoosting) || (!s.isHuman && s.boostTimer > 0);
                
                if (boosting && s.length > 20) { // ê¸¸ì´ 20 ì´ìƒì¼ ë•Œë§Œ ë¶€ìŠ¤íŠ¸ ê°€ëŠ¥
                    currentSpeed *= 2; // 2ë°° ì†ë„
                    s.length -= 0.1; // ê¸¸ì´ ê°ì†Œ (ë¹„ìš©)
                    
                    // ì…ì(ë˜¥) ë°°ì¶œ íš¨ê³¼ - ì‹œê°ì  + ì‹¤ì œ ë¨¹ì´
                    if (Math.random() < 0.2) {
                        addFood(s.body[s.body.length-1].x, s.body[s.body.length-1].y, 0.5);
                    }
                }

                s.x += Math.cos(s.angle) * currentSpeed;
                s.y += Math.sin(s.angle) * currentSpeed;

                // 3. ë²½ ì¶©ëŒ (ì£½ìŒ)
                if (s.x < 0 || s.x > MAP_SIZE || s.y < 0 || s.y > MAP_SIZE) {
                    killSnake(idx);
                    return;
                }

                // 4. ëª¸í†µ ì—…ë°ì´íŠ¸ (ë”°ë¼ì˜¤ê¸°)
                // ë¨¸ë¦¬ ìœ„ì¹˜ ì¶”ê°€
                s.body.unshift({x: s.x, y: s.y});
                
                // ê¼¬ë¦¬ ìë¥´ê¸° (ê¸¸ì´ ìœ ì§€)
                // ì‹¤ì œ ë°°ì—´ ê¸¸ì´ëŠ” length * density(ë°€ë„)ë¡œ ê´€ë¦¬
                let targetLen = Math.floor(s.length * 2); 
                while(s.body.length > targetLen) s.body.pop();

                // 5. ë¨¹ì´ ë¨¹ê¸°
                for(let i=foods.length-1; i>=0; i--) {
                    let f = foods[i];
                    if(Math.hypot(s.x - f.x, s.y - f.y) < s.radius + f.r + 5) {
                        s.length += f.val * 0.2; // ì„±ì¥
                        s.score += Math.ceil(f.val * 10);
                        s.radius = Math.min(30, 10 + s.length * 0.05); // í¬ê¸°ë„ ì•½ê°„ ì»¤ì§
                        foods.splice(i, 1);
                    }
                }

                // 6. ë‹¤ë¥¸ ì§€ë ì´ì™€ ì¶©ëŒ ì²´í¬
                snakes.forEach(other => {
                    if (s === other || other.dead) return;
                    
                    // ë‹¤ë¥¸ ì§€ë ì´ ëª¸í†µ ê²€ì‚¬
                    // ì„±ëŠ¥ ìµœì í™”: ê±°ë¦¬ ì²´í¬ ë¨¼ì €
                    if(Math.abs(s.x - other.x) > 1000 || Math.abs(s.y - other.y) > 1000) return;

                    // ëª¸í†µ ì „ì²´ ë£¨í”„ (ê°„ê²© ë‘ )
                    for(let i=0; i<other.body.length; i+=2) {
                        let bp = other.body[i];
                        if (Math.hypot(s.x - bp.x, s.y - bp.y) < s.radius + other.radius - 2) {
                            killSnake(idx); // ë¨¸ë¦¬ ë°•ì€ ìª½ì´ ì£½ìŒ
                            return;
                        }
                    }
                });
            });

            // ì ìˆ˜ ë° ë­í‚¹ ì—…ë°ì´íŠ¸
            if (playerIndex !== -1 && snakes[playerIndex]) {
                scoreBox.innerText = `ê¸¸ì´: ${Math.floor(snakes[playerIndex].length)}`;
            }
            updateLeaderboard();
        }

        function updateBotAI(b) {
            b.changeDirTimer--;
            if (b.boostTimer > 0) b.boostTimer--;

            // ê¸°ë³¸: ë¨¹ì´ ì°¾ê¸°
            if (b.changeDirTimer <= 0) {
                b.changeDirTimer = Math.random() * 50 + 20;
                
                // ê°€ì¥ ê°€ê¹Œìš´ ë¨¹ì´ ì°¾ê¸° (ì‹œì•¼ ì œí•œ)
                let closest = null;
                let minDist = 400; 
                
                // 1. ë²½ í”¼í•˜ê¸° (ìµœìš°ì„ )
                const margin = 200;
                if (b.x < margin) b.targetAngle = 0;
                else if (b.x > MAP_SIZE - margin) b.targetAngle = Math.PI;
                else if (b.y < margin) b.targetAngle = Math.PI/2;
                else if (b.y > MAP_SIZE - margin) b.targetAngle = -Math.PI/2;
                else {
                    // 2. ë¨¹ì´ íƒìƒ‰
                    for(let f of foods) {
                        let d = Math.hypot(b.x - f.x, b.y - f.y);
                        if(d < minDist) {
                            minDist = d;
                            closest = f;
                        }
                    }
                    if(closest) {
                        b.targetAngle = Math.atan2(closest.y - b.y, closest.x - b.x);
                    } else {
                         // ëœë¤ ë°°íšŒ
                        b.targetAngle += (Math.random() - 0.5) * 2;
                    }
                }
            }

            // 3. ì¶©ëŒ íšŒí”¼ (ê°„ë‹¨í•œ ë¡œì§)
            // ë°”ë¡œ ì•ì— ë‹¤ë¥¸ ë±€ì´ ìˆìœ¼ë©´ ê¸‰íšŒì „
            let lookX = b.x + Math.cos(b.angle) * 100;
            let lookY = b.y + Math.sin(b.angle) * 100;
            
            for(let other of snakes) {
                if(b === other || other.dead) continue;
                if(Math.hypot(b.x - other.x, b.y - other.y) > 500) continue;

                // ë‹¤ë¥¸ ë±€ì˜ ëª¸í†µì´ ë‚´ ì§„í–‰ë°©í–¥ ì•ì— ìˆëŠ”ì§€ í™•ì¸
                for(let i=0; i<other.body.length; i+=10) {
                    if(Math.hypot(lookX - other.body[i].x, lookY - other.body[i].y) < 50) {
                        b.targetAngle += Math.PI / 2; // 90ë„ íšŒí”¼
                        b.boostTimer = 20; // ë†€ë¼ì„œ ë¶€ìŠ¤íŠ¸
                        break;
                    }
                }
            }
        }

        function killSnake(idx) {
            let s = snakes[idx];
            s.dead = true;
            
            // ì‹œì²´ -> ë¨¹ì´ë¡œ ë³€í™˜
            // ëª¸í†µ ë§ˆë‹¤ ë¨¹ì´ ìƒì„± (ì¢€ ë“¬ì„±ë“¬ì„±)
            for(let i=0; i<s.body.length; i+=2) {
                addFood(s.body[i].x + (Math.random()-0.5)*20, s.body[i].y + (Math.random()-0.5)*20, 2);
            }

            if(s.isHuman) {
                gameOver();
            } else {
                // ë´‡ ë¶€í™œ
                setTimeout(() => { if(gameRunning) { snakes.splice(idx, 1); addSnake(false); } }, 2000);
            }
        }

        function draw() {
            let p = snakes[playerIndex];
            
            // í™”ë©´ í´ë¦¬ì–´
            ctx.fillStyle = '#1e272e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ì¹´ë©”ë¼ ì„¤ì •
            let zoom = 1;
            let camX = 0, camY = 0;

            if (p && !p.dead) {
                // ì¤Œ ì•„ì›ƒ (ê¸¸ì–´ì§ˆìˆ˜ë¡ ì‹œì•¼ ë„“ì–´ì§)
                zoom = Math.max(0.6, 1 - (p.length / 500));
                camX = canvas.width/2 - p.x * zoom;
                camY = canvas.height/2 - p.y * zoom;
            } else {
                // ì£½ì—ˆì„ ë• ë§ˆì§€ë§‰ ìœ„ì¹˜
                camX = canvas.width/2 - (p ? p.x : MAP_SIZE/2) * zoom;
                camY = canvas.height/2 - (p ? p.y : MAP_SIZE/2) * zoom;
            }

            ctx.save();
            ctx.translate(camX, camY);
            ctx.scale(zoom, zoom);

            // ë°°ê²½ ê²©ì
            ctx.lineWidth = 1;
            ctx.strokeStyle = '#2f3640';
            ctx.beginPath();
            for(let x=0; x<=MAP_SIZE; x+=100) { ctx.moveTo(x,0); ctx.lineTo(x,MAP_SIZE); }
            for(let y=0; y<=MAP_SIZE; y+=100) { ctx.moveTo(0,y); ctx.lineTo(MAP_SIZE,y); }
            ctx.stroke();

            // ë§µ ê²½ê³„
            ctx.strokeStyle = '#e74c3c'; ctx.lineWidth = 5;
            ctx.strokeRect(0,0,MAP_SIZE,MAP_SIZE);

            // ë¨¹ì´ ê·¸ë¦¬ê¸°
            for(let f of foods) {
                // í™”ë©´ ë°– ìµœì í™” (Culling)
                // ê°„ë‹¨íˆ í˜„ì¬ ë·°í¬íŠ¸ + ì—¬ìœ ë¶„ ê³„ì‚° ìƒëµí•˜ê³  ë‹¤ ê·¸ë¦¬ë˜, ë„ˆë¬´ ë§ìœ¼ë©´ ì„±ëŠ¥ ì´ìŠˆ. 
                // ì—¬ê¸°ì„œëŠ” ë Œë”ë§
                ctx.globalAlpha = 0.8;
                ctx.fillStyle = f.color;
                ctx.beginPath(); ctx.arc(f.x, f.y, f.r * (1 + Math.sin(Date.now()/200)*0.2), 0, Math.PI*2); // ë°˜ì§ì„ íš¨ê³¼
                ctx.fill();
            }
            ctx.globalAlpha = 1;

            // ì§€ë ì´ ê·¸ë¦¬ê¸°
            // ì£½ì€ ì§€ë ì´ëŠ” ì•ˆ ê·¸ë¦¼ (ì´ë¯¸ ë¨¹ì´ ë¨)
            // *ì¤‘ìš”* ì ìˆ˜ê°€ ë‚®ì€ ì§€ë ì´ë¥¼ ë¨¼ì € ê·¸ë ¤ì•¼ ê²¹ì¹  ë•Œ ìì—°ìŠ¤ëŸ¬ì›€
            let sortedSnakes = [...snakes].sort((a,b) => a.score - b.score);

            sortedSnakes.forEach(s => {
                if(s.dead) return;

                // ëª¸í†µ
                ctx.fillStyle = s.color;
                // ëª¸í†µì„ ê²¹ì³ì„œ ê·¸ë¦¼ (Slither ìŠ¤íƒ€ì¼)
                for(let i = s.body.length-1; i>=0; i--) {
                    let part = s.body[i];
                    // ë¨¸ë¦¬ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ì¡°ê¸ˆ í¼
                    let r = s.radius;
                    // ìµœì í™”: í™”ë©´ ë°– ê±´ë„ˆë›°ê¸° ê°€ëŠ¥
                    ctx.beginPath(); 
                    ctx.arc(part.x, part.y, r, 0, Math.PI*2);
                    ctx.fill();
                }

                // ë¨¸ë¦¬ (ëˆˆ ê·¸ë¦¬ê¸°)
                ctx.save();
                ctx.translate(s.x, s.y);
                ctx.rotate(s.angle);
                
                // ì–¼êµ´
                ctx.fillStyle = s.color;
                ctx.beginPath(); ctx.arc(0, 0, s.radius + 2, 0, Math.PI*2); ctx.fill();

                // ëˆˆ (í°ì)
                ctx.fillStyle = 'white';
                ctx.beginPath(); ctx.arc(s.radius/2, -s.radius/2, s.radius/3, 0, Math.PI*2); ctx.fill();
                ctx.beginPath(); ctx.arc(s.radius/2, s.radius/2, s.radius/3, 0, Math.PI*2); ctx.fill();

                // ëˆˆ (ê²€ì€ì) - ë§ˆìš°ìŠ¤/íƒ€ê²Ÿ ë°©í–¥ ë´„
                ctx.fillStyle = 'black';
                ctx.beginPath(); ctx.arc(s.radius/2 + 2, -s.radius/2, s.radius/6, 0, Math.PI*2); ctx.fill();
                ctx.beginPath(); ctx.arc(s.radius/2 + 2, s.radius/2, s.radius/6, 0, Math.PI*2); ctx.fill();

                ctx.restore();

                // ì´ë¦„í‘œ
                ctx.fillStyle = 'white';
                ctx.font = `bold ${Math.max(12, s.radius)}px Noto Sans KR`;
                ctx.textAlign = 'center';
                ctx.fillText(s.name, s.x, s.y - s.radius - 10);
            });

            ctx.restore();
        }

        function updateLeaderboard() {
            let list = [...snakes].filter(s => !s.dead).sort((a,b) => b.length - a.length);
            let html = '';
            for(let i=0; i<Math.min(5, list.length); i++) {
                let s = list[i];
                let name = s.isHuman ? `<span style="color:#fab1a0">${s.name}</span>` : s.name;
                html += `<li>${i+1}. ${name} <small>(${Math.floor(s.length)})</small></li>`;
            }
            rankList.innerHTML = html;
        }

        function gameOver(killerName) {
            gameRunning = false;
            cancelAnimationFrame(animationFrameId);
            uiLayer.style.display = 'flex';
            document.getElementById('ui-title').innerText = "ğŸ’€ ê²Œì„ ì˜¤ë²„";
            document.getElementById('ui-desc').innerHTML = `
                ìµœì¢… ê¸¸ì´: <span style="color:#e17055">${Math.floor(snakes[playerIndex].length)}</span><br>
                ë” í¬ê²Œ ì„±ì¥í•´ì„œ ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”!
            `;
            startBtn.innerText = "ë‹¤ì‹œ ë„ì „í•˜ê¸° â†º";
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                const toast = document.getElementById("toast");
                toast.className = "show";
                setTimeout(() => toast.className = toast.className.replace("show", ""), 3000);
            });
        }

        // ì‹¤í–‰
        init();
    </script>
</body>
</html>
